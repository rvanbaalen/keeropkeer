function e(e){return document.getElementById(e)}function o(e=6){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,e)}function l(e,o){Array.prototype.forEach.call(document.querySelectorAll(e),o)}function r(e,o={},l){let r=document.createElement(e);return Object.keys(o).forEach((function(e){r[e]=o[e]})),l&&l.append(r),r}function c(e){let o=r("div");return o.innerHTML=e,o.firstElementChild}var a={modal:{newGame:{body:"Weet je zeker dat je een nieuw spel wil beginnen?"}},label:{cancel:"Annuleren",ok:"OK",newGame:"Nieuw spel",bonus:"bonus",columns:"A-O",stars:"Sterren",totals:"Totaal",jokers:"Jokers"},notification:{landscapeMode:"Draai het scherm horizontaal om te beginnen.",selectLevel:"Selecteer een level.",playerName:"Wat is je naam?",createLobby:"Kies een spelcode:",creatingLobby:"Bezig met het aanmaken van de lobby...",playerJoined:{title:"Een speler is verbonden",message:(e="onbekend")=>`${e} speelt mee!`},playerDisconnected:{title:"Verbinding met speler verbroken",message:(e="onbekend")=>`${e} is niet meer verbonden.`}},lobbyStats:(e,o)=>` er ${o>1?"zijn":"is"} ${o} speler${o>1?"s":""} in lobby '${e}'`};document.querySelector("body").classList.add("lang-nl");const t=a,s={GAME_NEW:"new-game",GAME_RESET:"state-reset",GAME_START:"start-game",LEVEL_SELECT:"level-select",LEVEL_LOADED:"level-loaded",SCORE_RELOAD:"score-reload",SCORE_TOTAL_TOGGLE:"score-total-toggle",MODAL_TOGGLE:"modal-toggle",MODAL_HIDE:"modal-hide",MODAL_SHOW:"modal-show",LOBBY_READY:"lobby-ready",LOBBY_JOIN:"lobby-join",LOBBY_JOIN_FAILED:"lobby-join-failed",LOBBY_JOINED:"lobby-joined",LOBBY_CREATED:"lobby-created",LOBBY_DELETED:"lobby-deleted",PLAYER_REGISTERED:"player-registered",PLAYER_REGISTRATION_FAILED:"player-registration-failed",PLAYER_DELETED:"player-deleted",GRID_BLOCK_SELECTED:"grid-block-selected",GRID_COLUMN_COMPLETE:"grid-column-complete",ENGINE_GRID_RENDER_COMPLETE:"grid-render-complete",JOKER_SELECTED:"joker-selected",STAR_SELECTED:"star-selected",RENDER_JOKER_SCORE:"render-joker-score",RENDER_BONUS_SCORE:"render-bonus-score",RENDER_COLUMN_SCORE:"render-column-score",RENDER_STAR_SCORE:"render-star-score",RENDER_TOTAL_SCORE:"render-total-score",RENDER_LEVEL:"render-level",RENDER_SCORES:"render-scores",LOADING:"loading",LOADING_DONE:"loading-done",GAME_CONNECTED:"game-connected",PLAYER_JOINED:"player-joined",LEVEL_SELECT_DOM:"level-select-dom"};function n(o,l){console.info("Fired event: "+o,l);let r=new CustomEvent(o,{detail:l});e("app").dispatchEvent(r)}function i(o,l){e("app").addEventListener(o,l,!1)}window.EVENTS=s,window.dispatch=n,window.listen=i;const d=(0,window.io)("http://192.168.1.111:3000/",{autoConnect:!1});function u(l){let r={...{id:"modal-"+o(),message:"No modal message is set.",buttons:!1,appendTo:"#app",visible:!1},...l};!0===r.buttons&&(r.buttons={cancel:{id:r.id+"-cancel",label:t.label.cancel},ok:{id:r.id+"-ok",label:t.label.ok}});let a=c(`\n        <div class="modal-overlay${r.visible?" show":""}" id="${r.id}">\n            <div class="modal-container">\n                ${r.title?`\n                <div class="modal-title">\n                    <h2>${r.title}</h2>\n                </div>\n                `:""}\n                ${r.body&&!r.message?r.body:`\n                <div class="modal-body">\n                    <p>${r.message}</p>\n                </div>\n                `}\n                ${r.buttons?`\n                <div class="modal-button-bar">\n                    ${r.buttons.cancel?`<a href="#" id="${r.buttons.cancel.id}" class="button button-cancel">${r.buttons.cancel.label}</a>`:""}\n                    ${r.buttons.ok?`<a href="#" id="${r.buttons.ok.id}" class="button button-confirm">${r.buttons.ok.label}</a>`:""}\n                </div>\n                `:""}\n            </div>\n        </div>\n    `);return r.buttons.cancel&&"function"==typeof r.buttons.cancel.callback&&a.querySelector("#"+r.buttons.cancel.id).addEventListener("click",r.buttons.cancel.callback,!1),r.buttons.ok&&"function"==typeof r.buttons.ok.callback&&a.querySelector("#"+r.buttons.ok.id).addEventListener("click",r.buttons.ok.callback,!1),e("app").append(a),a}localStorage.setItem("debug","socket.io-client:socket"),d.onAny(((e,...o)=>{console.log(e,o)}));class g{static TRANSITION_DELAY=200;constructor(){}static hide(o){const{id:l,timeout:r=400}=o;e(l)&&(e(l).classList.remove("show"),setTimeout((()=>{const o=e(l);o&&o.remove()}),r))}static removePrevious(){let e=document.querySelectorAll(".notification.show").length;if(e>0){let e=200;l(".notification.show",(o=>{g.hide({id:o.id,timeout:e}),e+=200}))}return e}static show(o){const l=g.removePrevious(),r=o=>{"string"==typeof o&&(o={title:o});let{message:l,title:r="No message specified.",timeout:c=4e3,autoHide:a=!1}=o;const t=g.createTemplate(l,r);document.body.append(t),setTimeout((()=>{e(t.id).classList.toggle("show")}),1),a&&setTimeout((()=>{g.hide({id:t.id})}),c)};l>0?setTimeout((()=>{r(o)}),200*l+200):r(o)}static createTemplate(e,l=!1){return c(`\n            <div class="notification" id="${"notification_"+o(5)}">\n                ${l?`\n                <h2>${l}</h2>\n                `:""}\n                ${e?`\n                <p>${e}</p>\n                `:""}\n            </div>\n        `)}}class b{static prefix="kok_";static removeItem(e){return localStorage.removeItem(b.prefix+e)}static setItem(e,o=""){return localStorage.setItem(b.prefix+e,JSON.stringify(o))}static getItem(e,o=!1){let l=localStorage.getItem(b.prefix+e);return null===l?o:JSON.parse(l)}}class m{#lobby=!1;state=!1;constructor(e){this.lobby=e,d.on("player:stats",(({player:e})=>{m.setLobbyCodeDom({code:e.lobbyCode})})),d.on("lobby:updated",(({lobby:e})=>{this.lobby=e,m.setLobbyCodeDom({code:this.lobby.code})})),d.once("lobby:joined",(({lobby:e})=>{this.lobby=e})),d.once("lobby:created",(({lobby:e})=>{this.lobby=e}))}static async joinOrCreate(e){if(e)d.emit("lobby:join",{lobbyCode:e});else{const e=prompt(t.notification.createLobby,o(4).toUpperCase());d.emit("lobby:create",{lobbyCode:e})}return new Promise(((e,o)=>{d.once("lobby:joined",(({lobby:o})=>{e(new m(o))})),d.once("lobby:created",(({lobby:o})=>{e(new m(o))})),setTimeout((()=>{o("Lobby creation timeout.")}),1e4)}))}static setLobbyCodeDom({code:o}){const l=e("lobbyCode");l&&(l.innerText=o)}static setState(e){d.emit("lobby:state",{key:"state",value:e})}leave(){d.emit("lobby:leave",{lobbyCode:this.code})}get players(){return this.lobby?.players||[]}get code(){return this.lobby?.code}static get cachedLobbyCode(){return b.getItem("lobby",!1)}get state(){return this.lobby?.state}set lobby(e){e.code!==this.#lobby.code&&b.setItem("lobby",e.code),this.#lobby=e}get lobby(){return this.#lobby}get playerNames(){return this.players.map((e=>e.username)).join(", ")}static template(e="",o=-1){const l={...v};return l.code=e,l.playerId=o,l}}const v={members:[],playerId:-1,code:"KOK123",data:{columnScores:{A:-1,B:-1,C:-1,D:-1,E:-1,F:-1,G:-1,H:-1,I:-1,J:-1,K:-1,L:-1,M:-1,N:-1,O:-1},colorScores:{high:{yellow:-1,green:-1,blue:-1,red:-1,orange:-1},low:{yellow:-1,green:-1,blue:-1,red:-1,orange:-1}}}},y=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"yellow"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"green"},{color:"red"},{color:"orange"},{color:"blue",star:!0},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow",star:!0},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"green"},{color:"orange"},{color:"red",star:!0},{color:"blue"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"green"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"orange"},{color:"green",star:!0},{color:"blue"},{color:"blue"},{color:"red"},{color:"red"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green",star:!0},{color:"orange"},{color:"red"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"red"},{color:"green"},{color:"orange"},{color:"yellow",star:!0},{color:"yellow"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"green"},{color:"orange"},{color:"orange"},{color:"yellow"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"red",star:!0},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"blue"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"red",star:!0},{color:"red"},{color:"blue"},{color:"orange"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]}],E=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"green",star:!0}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"orange"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"yellow"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"red"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"red"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"green"},{color:"green",star:!0}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"green"},{color:"blue"},{color:"yellow"},{color:"orange",star:!0}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"yellow",star:!0},{color:"blue"},{color:"orange"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"blue"},{color:"blue"},{color:"red",star:!0},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"blue"},{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"orange"},{color:"orange"},{color:"green"}]}],p=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"blue"},{color:"orange"},{color:"green",star:!0},{color:"green"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"green"},{color:"red"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"red",star:!0},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"red"},{color:"yellow",star:!0},{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"green",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"orange"},{color:"orange"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"blue"},{color:"red",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"},{color:"yellow",star:!0},{color:"green"},{color:"green"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"blue",star:!0},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"blue"},{color:"blue"},{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"red"},{color:"red"},{color:"red"},{color:"yellow"}]}],L=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"green"},{color:"green"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"blue"},{color:"yellow",star:!0},{color:"yellow"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"green"},{color:"green"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"red"},{color:"red"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"green",star:!0},{color:"green"},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"orange"},{color:"orange"},{color:"red"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"yellow",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"green"},{color:"red"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"green"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"yellow"},{color:"blue"},{color:"orange",star:!0},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green",star:!0},{color:"red"},{color:"red"},{color:"blue"},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"yellow"},{color:"red",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"red"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"yellow"},{color:"orange",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"red"}]}];class h{selectedLevel=!1;static levelMap={level1:y,level2:E,level3:p,level4:L};constructor(e){e.level&&(this.level=e.level),i(s.LEVEL_LOADED,(()=>{n(s.MODAL_HIDE,{modalId:"selectLevelModal"})})),i(s.LEVEL_SELECT_DOM,(e=>{const{level:o,element:l}=e.detail;h.selectInDom(o,l)})),i(s.GAME_START,(()=>{n(s.MODAL_HIDE,{modalId:"selectLevelModal"})})),d.on("level:selected",(({selectedLevel:e})=>{n(s.LEVEL_SELECT_DOM,{level:e}),this.level=e})),d.on("lobby:created",(({lobby:e})=>{n(s.LEVEL_SELECT_DOM,{level:e.level}),this.level=e.level}))}static selectInDom(o,r=!1){if(l(".level-image-container a",(e=>{e.classList.remove("selected")})),""!==o){if(r||(r=e(o)),!r)return;r.parentElement.classList.add("selected")}}reset(){b.removeItem("level"),this.selectedLevel=!1}select({Player:o,Lobby:r}){const c="selectLevelModal";e(c)||function({modalId:o,Player:r,Lobby:c}){u({id:o,visible:!1,message:!1,body:`\n                <div class="new-game-container">\n                    <div class="lobby-container">\n                        <ul>\n                            <li id="playerNameWrap">Player: <span id="playerName">${r.name}</span></li>\n                            <li id="lobbyWrap">Game code: <span id="lobbyCode">${c.code}</span></li>\n                            <li id="playersJoinedWrap">Players joined (<span id="playerTotal">${c.players.length}</span>): <span id="playerNames">${c.playerNames}</span></li>\n                            <li id="startGameWrap"><button id="start">Start game</button></li>\n                        </ul>\n                    </div>\n                    <div class="level-image-container">\n                        <a href="#">\n                            <span>Level 1</span>\n                            <img src="/images/level1.png" alt="Level 1" class="level-image" id="level1">\n                        </a>\n                        <a href="#">\n                            <span>Level 2</span>\n                            <img src="/images/level2.png" alt="Level 2" class="level-image" id="level2">\n                        </a>\n                        <a href="#">\n                            <span>Level 3</span>\n                            <img src="/images/level3.png" alt="Level 3" class="level-image" id="level3">\n                        </a>\n                        <a href="#">\n                            <span>Level 4</span>\n                            <img src="/images/level4.png" alt="Level 4" class="level-image" id="level4">\n                        </a>\n                    </div>\n                </div>\n            `,buttons:!1});let a=!1;l(".level-image-container a",(e=>{e.addEventListener("click",(e=>{e.preventDefault(),a=e.target.id,n(s.LEVEL_SELECT_DOM,{level:a,element:e.target}),d.emit("level:select",{selectedLevel:a})}),!1)})),e("start").addEventListener("click",(o=>{if(o.preventDefault(),0===e("app").querySelectorAll(".level-image-container a.selected").length)return alert(t.notification.selectLevel),!1;n(s.GAME_START)}),!1)}({modalId:c,Player:o,Lobby:r}),n(s.MODAL_SHOW,{modalId:c})}set level(e){this.selectedLevel=e}get level(){return h.levelMap[this.selectedLevel]}}class S{static JOKER_VALUE=1;static STAR_VALUE=-2;constructor(){i(s.JOKER_SELECTED,(e=>{dispatch(s.RENDER_SCORES,{scores:{jokers:this.jokerScore}})})),i(s.STAR_SELECTED,(()=>{dispatch(s.RENDER_SCORES,{scores:{stars:this.starScore}})})),i(s.SCORE_RELOAD,(()=>{dispatch(s.RENDER_SCORES,{scores:{bonus:this.bonusScore,columns:this.columnScore,jokers:this.jokerScore,stars:this.starScore,total:this.total}})})),i(s.SCORE_TOTAL_TOGGLE,(()=>{this.toggleTotalScore()}))}get total(){return this.bonusScore+this.columnScore+this.jokerScore+this.starScore}get columnScore(){let e=document.querySelectorAll("span.column-score.active"),o=0;return Array.prototype.forEach.call(e,(e=>{let l=parseInt(e.innerText);o+=l})),o}get jokerScore(){let e=document.getElementsByClassName("joker"),o=e.length,l=0;return Array.prototype.forEach.call(e,(e=>{e.classList.contains("used")&&l++})),(o-l)*S.JOKER_VALUE}get bonusScore(){let e=document.querySelectorAll(".final-selected span"),o=0;return Array.prototype.forEach.call(e,(e=>{o+=parseInt(e.innerText)})),o}get starScore(){const e=document.querySelectorAll("span.selected span.star").length;return(document.querySelectorAll("span.star").length-e)*S.STAR_VALUE}toggleTotalScore(){let o=e("totalScore");o.classList.contains("hide")?(o.innerText=this.total,o.classList.remove("hide")):(o.innerText="",o.classList.add("hide"))}}class w{constructor(){}static get cachedId(){return b.getItem("sessionId")}static set cachedId(e){return b.setItem("sessionId",e)}}class T{#cachedPlayer=!1;constructor(){const e=w.cachedId;!1!==e?(d.auth={sessionId:e,username:T.cachedName},d.connect()):this.createPlayer(),d.once("player:created",(({player:e})=>{this.player=e})),d.on("player:updated",(({player:e})=>{this.player=e})),d.on("player:stats",(({totalPlayers:e,players:o})=>{T.setPlayerNamesDom({players:o}),T.setPlayerTotalDom({totalPlayers:e})})),d.on("player:connected",(e=>{g.show({title:t.notification.playerJoined.title,message:t.notification.playerJoined.message(e.username),autoHide:!0})})),d.on("player:disconnected",(({player:e})=>{}))}static setPlayerTotalDom({totalPlayers:o}){const l=e("playerTotal");l&&(l.innerText=o)}static setPlayerNamesDom({players:o}){const l=e("playerNames");l&&(l.innerText=o.join(", "))}static setPlayerNameDom({player:o}){const l=e("playerName");l&&(l.innerText=o.username)}createPlayer(){const e=prompt(t.notification.playerName);this.player={username:e},this.connectPlayer(this.player)}connectPlayer(e){console.log("Connecting player!",e),d.auth=e,d.connect()}delete(){return b.removeItem("player")}set player(e){if(!e.username)throw new Error("Invalid player object. No username.");this.#cachedPlayer=e,b.setItem("player",e.username),T.setPlayerNameDom(e.username)}get player(){return this.#cachedPlayer}static get cachedName(){return b.getItem("player")}get name(){return this.#cachedPlayer.username}get id(){return this.#cachedPlayer?.id||o(6).toLowerCase()}}class O{static COLORS=["green","yellow","blue","red","orange"];static TOTAL_JOKERS=8;static STATE={LEVEL_SELECT:"levelSelect",IN_GAME:"inGame"};Lobby;Level;Score;Player;#cachedState=!1;constructor(){this.Player=new T,this.registerHandlers(),d.on("connect",(()=>{console.clear(),this.initialize()}))}initialize(){m.joinOrCreate(m.cachedLobbyCode).then((e=>{this.Lobby=e,this.Level=new h(e),this.Score=new S,this.start()})).catch((e=>{console.error("Failed to create lobby",e)}))}registerHandlers(){i(s.GAME_NEW,(()=>{this.resetState(),m.setState(O.STATE.LEVEL_SELECT)})),i(s.GAME_RESET,(()=>{n(s.GAME_START)})),i(s.GAME_START,(()=>{console.log("Broadcasting GAME START to SOCKET"),d.emit("game:start")})),d.on("game:start",(()=>{console.log("RECEIVED GAME START FROM SERVER"),this.start()})),d.on("level:selected",(()=>{this.state=this.createState()})),d.on("lobby:updated",(({lobby:e})=>{switch(e.state){case"levelSelect":this.Level.select({Player:this.Player,Lobby:this.Lobby});break;case"inGame":this.load()}}))}start(){this.state?(this.load(),m.setState("inGame")):this.Level.select({Player:this.Player,Lobby:this.Lobby})}load(){n(s.MODAL_HIDE,{modalId:"selectLevelModal"}),n(s.RENDER_LEVEL)}resetState(){this.Level.reset(),this.state=!1,n(s.GAME_RESET)}createState(){console.log("SETTING STATE LEVEL",this.Level.level);let e,o={grid:this.Level.level,jokers:[],colorScores:{high:[],low:[]}};for(e=0;e<O.TOTAL_JOKERS;e++)o.jokers.push({selected:!1});return O.COLORS.forEach((e=>{o.colorScores.high.push({color:e,value:0}),o.colorScores.low.push({color:e,value:0})})),o}get state(){return this.#cachedState||(this.#cachedState=b.getItem("state",!1)),this.#cachedState}set state(e){this.#cachedState=e,e?b.setItem("state",e):b.removeItem("state")}updateState(e,o,l,r,c="grid"){let a=this.state,t=!1;a.grid.forEach(((s,n)=>{s.column===e&&(a.grid[n][c][o][l]=r,t=!0)})),t&&(this.state=a,n(s.RENDER_LEVEL))}updateBlockState(e,o,l,r){let c=this.state,a=!1;c.grid.forEach(((t,s)=>{t.column===e&&(c.grid[s].grid[o][l]=r,a=!0)})),a&&(this.state=c,n(s.RENDER_LEVEL))}updateJokerState(e,o){let l=this.state,r=!1;l.jokers.forEach(((l,c)=>{c===e&&(l.selected=o,r=!0)})),r&&(this.state=l,n(s.RENDER_LEVEL))}updateColorScoreState(e,o,l){let r=!1,c=this.state;c.colorScores[e].forEach((e=>{e.color===o&&(e.value=l,r=!0)})),r&&(this.state=c,n(s.RENDER_LEVEL))}}class _{currentGame=!1;version;constructor(){i(s.MODAL_TOGGLE,(o=>{const{modalId:l}=o.detail;e(l)&&e(l).classList.toggle("show")})),i(s.MODAL_HIDE,(o=>{const{modalId:l}=o.detail;e(l)&&e(l).classList.contains("show")&&e(l).classList.remove("show")})),i(s.MODAL_SHOW,(o=>{const{modalId:l}=o.detail;e(l)&&!e(l).classList.contains("show")&&e(l).classList.add("show")})),this.currentGame=new O,this.parseOrientationOverlay(),this.parseGenericLoading(),i(s.LOADING,(()=>{n(s.MODAL_SHOW,{modalId:"genericLoading"})})),i(s.RENDER_LEVEL,(()=>{this.render()})),i(s.RENDER_JOKER_SCORE,(e=>{this.renderJokerScore(e.detail.value)})),i(s.RENDER_SCORES,(e=>{const{scores:o}=e.detail;void 0!==o.bonus&&this.renderBonusScore(o.bonus),void 0!==o.columns&&this.renderColumnScore(o.columns),void 0!==o.jokers&&this.renderJokerScore(o.jokers),void 0!==o.stars&&this.renderStarScore(o.stars)})),d.on("version",(e=>{b.setItem("version",e)})),d.on("session",(({sessionId:e})=>{w.cachedId=e})),d.on("disconnect",(()=>{}))}renderBonusScore(o){e("bonusTotal").innerText=o}renderColumnScore(o){e("columnsTotal").innerText=o}renderJokerScore(o){e("jokerTotal").innerText=o}renderStarScore(o){e("starsTotal").innerText=o}parseOrientationOverlay(){u({id:"orientationModal",message:t.notification.landscapeMode})}parseGenericLoading(){u({visible:!1,id:"genericLoading",message:"Aan het laden.. een moment geduld."})}parseColumnGrid(o){e("blockGrid").innerHTML="",o.grid.forEach((o=>{e("blockGrid").append(this.parseColumn(o))}));let l=document.querySelectorAll(".score-block:not(.final-score)");Array.prototype.forEach.call(l,(e=>{e.addEventListener("click",(()=>{let o=!e.classList.contains("selected");this.currentGame.updateBlockState(e.data.column,e.data.row,"selected",o),n(s.GRID_BLOCK_SELECTED,{selected:o,block:e}),e.querySelectorAll(".star").length>0&&n(s.STAR_SELECTED,{selected:o,block:e})}),!1)}))}parseJokerColumn(o){let l=e("jokerContainer");l.innerHTML="",o.jokers.forEach((e=>{let o=r("span",{className:"joker",innerText:"!"});e.selected&&o.classList.add("used"),l.append(o)}));let c=document.getElementsByClassName("joker");Array.prototype.forEach.call(c,((e,o)=>{e.addEventListener("click",(()=>{let l=!e.classList.contains("used");this.currentGame.updateJokerState(o,l),n(s.JOKER_SELECTED,{joker:e,selected:l})}),!1)}))}parseScoreColumns(o){e("scoreColumn1").innerHTML="",o.colorScores.high.forEach((o=>{let l=r("span",{className:"score-block final-score "+o.color});-1===o.value&&l.classList.add("selected"),5===o.value&&l.classList.add("final-selected"),r("span",{innerText:5},l),e("scoreColumn1").append(l)})),e("scoreColumn2").innerHTML="",o.colorScores.low.forEach((o=>{let l=r("span",{className:"score-block final-score "+o.color});-1===o.value&&l.classList.add("selected"),3===o.value&&l.classList.add("final-selected"),r("span",{innerText:3},l),e("scoreColumn2").append(l)}));let l=function(e,o=5,l=-1){return e.classList.contains("final-selected")||e.classList.contains("selected")?e.classList.contains("final-selected")&&!e.classList.contains("selected")?l:0:o},c=function(e){let o="";return O.COLORS.forEach((l=>{e.classList.contains(l)&&(o=l)})),o},a=document.querySelectorAll("#scoreColumn1 .final-score");Array.prototype.forEach.call(a,(e=>{e.addEventListener("click",(()=>{this.currentGame.updateColorScoreState("high",c(e),l(e,5,-1)),n(s.SCORE_RELOAD)}),!1)}));let t=document.querySelectorAll("#scoreColumn2 .final-score");Array.prototype.forEach.call(t,(e=>{e.addEventListener("click",(()=>{this.currentGame.updateColorScoreState("low",c(e),l(e,3,-1)),n(s.SCORE_RELOAD)}),!1)}));let i=document.querySelectorAll("span.column-score");Array.prototype.forEach.call(i,(e=>{e.addEventListener("click",(()=>{let o,l=e.data.column,r=e.data.row;o=e.classList.contains("active")||e.classList.contains("taken")?e.classList.contains("active")&&!e.classList.contains("taken")?"taken":"default":"active",this.currentGame.updateState(l,r,"state",o,"score"),n(s.SCORE_RELOAD)}),!1)}))}parseGrid(){this.parseColumnGrid(this.currentGame.state),this.parseJokerColumn(this.currentGame.state),this.parseScoreColumns(this.currentGame.state),n(s.ENGINE_GRID_RENDER_COMPLETE)}parseTotalScores(){if(e("totalScores"))return;const o=`\n            <div id="totalScores">\n                <div class="totals" id="bonus"><label>${t.label.bonus}</label><span class="label">=</span><span id="bonusTotal" class="totalValue">15</span></div>\n                <div class="totals" id="columns"><label>${t.label.columns}</label><span class="label">+</span><span id="columnsTotal" class="totalValue"></span></div>\n                <div class="totals" id="jokers"><label>${t.label.jokers}</label><span class="label">+</span><span id="jokerTotal" class="totalValue"></span></div>\n                <div class="totals" id="stars"><label>${t.label.stars}</label><span class="label">-</span><span id="starsTotal" class="totalValue"></span></div>\n                <div class="totals" id="totals">\n                    <label>${t.label.totals}</label><span class="label">&nbsp;</span><span id="totalScore" class="totalValue hide"></span>\n                </div>\n            </div>\n        `;e("scoreColumn").append(c(o)),e("totals").addEventListener("click",(()=>{n(s.SCORE_SHOW)}),!1)}renderNewGameButton(o){const l="newGame";if(e(l))return;const r=function(e={}){const o={callback:()=>!1,className:"button",...e};let l=c(`<a>${o.label}</a>`);return o.callback&&"function"==typeof o.callback&&l.addEventListener("click",o.callback,!1),o.className&&(l.className=o.className),o.id&&(l.id=o.id),l}({callback:o,id:l,label:t.label.newGame,className:"new-game"});return e("grid").append(r),r}render(e){this.parseGrid(e),this.parseTotalScores();const o="newGameModal";!function({modalId:e="newGameModal"}){u({id:e,message:t.modal.newGame.body,buttons:{cancel:{id:e+"Cancel",label:t.label.cancel,callback(o){o.preventDefault(),n(s.MODAL_TOGGLE,{modalId:e})}},ok:{id:e+"Confirm",label:t.label.ok,callback(o){o.preventDefault(),n(s.MODAL_TOGGLE,{modalId:e}),n(s.GAME_NEW)}}}})}({modalId:o}),this.renderNewGameButton((e=>{e.preventDefault(),n(s.MODAL_SHOW,{modalId:o})})),n(s.SCORE_RELOAD)}parseColumn(e){let o=r("div",{className:"column"+("H"===e.column?" highlight":"")});r("span",{className:"letter rounded-block",innerText:e.column},o),e.grid.forEach(((l,c)=>{const a=r("span",{className:"score-block "+l.color,data:{column:e.column,row:c}});l.star&&r("span",{className:"star",innerText:"*"},a),l.selected&&a.classList.add("selected"),o.append(a)}));let l=r("div",{className:"column-score"});e.score.forEach(((o,c)=>{r("span",{className:"rounded-block column-score"+(o.state&&"default"!==o.state?" "+o.state:""),innerText:o.value,data:{column:e.column,row:c}},l)})),o.append(l);let c=o.querySelectorAll(".score-block"),a=o.querySelectorAll(".selected"),t=o.querySelector(".letter").innerText.toUpperCase();return c.length===a.length&&n(s.GRID_COLUMN_COMPLETE,{columnLetter:t}),o}}try{new _}catch(e){console.error("Failed to load game. Reset state!",e)}window.socket=d;
