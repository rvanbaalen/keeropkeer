function e(e){return document.getElementById(e)}function o(e=6){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,e)}function l(e,o){Array.prototype.forEach.call(document.querySelectorAll(e),o)}function r(e,o={},l){let r=document.createElement(e);return Object.keys(o).forEach((function(e){r[e]=o[e]})),l&&l.append(r),r}function t(e){let o=r("div");return o.innerHTML=e,o.firstElementChild}var a={modal:{newGame:{body:"Weet je zeker dat je een nieuw spel wil beginnen?"}},label:{cancel:"Annuleren",ok:"OK",newGame:"Nieuw spel",bonus:"bonus",columns:"A-O",stars:"Sterren",totals:"Totaal",jokers:"Jokers"},messages:{connecting:"Bezig met verbinden ..."},notification:{landscapeMode:"Draai het scherm horizontaal om te beginnen.",selectLevel:"Selecteer een level.",playerName:"Wat is je naam?",createLobby:"Kies een spelcode:",creatingLobby:"Bezig met het aanmaken van de lobby...",playerJoined:{title:"Een speler is verbonden",message:(e="onbekend")=>`${e} speelt mee!`}},lobbyStats:(e,o)=>` er ${o>1?"zijn":"is"} ${o} speler${o>1?"s":""} in lobby '${e}'`};document.querySelector("body").classList.add("lang-nl");const c=a,n="game-new",s="game-start",i="game-create-state",d="score-reload",u="score-total-toggle",g="modal-toggle",m="modal-hide",v="modal-show",b="grid-block-selected",y="grid-render-complete",p="joker-selected",h="star-selected",w="render-level",S="render-scores",L="loading",f="level-select-dom",k="score-toggle-column",T="navigate-from",C="navigate-to",E="navigate",$=e("app"),I={};function A(e,o){console.info("Fired event: "+e,o);let l=new CustomEvent(e,{detail:o});$.dispatchEvent(l),I[e]?.once&&(console.log("remove listener for ",e),$.removeEventListener(e,I[e].callback,!1))}function P(e,o,l=!1){$.addEventListener(e,o,!1),l&&(I[e]={once:!0,callback:o})}const j=(0,window.io)("http://192.168.1.111:3000/",{autoConnect:!1});function G(l){let r={...{id:"modal-"+o(),message:"No modal message is set.",buttons:!1,appendTo:"#app",visible:!1},...l};!0===r.buttons&&(r.buttons={cancel:{id:r.id+"-cancel",label:c.label.cancel},ok:{id:r.id+"-ok",label:c.label.ok}});let a=t(`\n        <div class="modal-overlay${r.visible?" show":""}" id="${r.id}">\n            <div class="modal-container">\n                ${r.title?`\n                <div class="modal-title">\n                    <h2>${r.title}</h2>\n                </div>\n                `:""}\n                ${r.body&&!r.message?r.body:`\n                <div class="modal-body">\n                    <p>${r.message}</p>\n                </div>\n                `}\n                ${r.buttons?`\n                <div class="modal-button-bar">\n                    ${r.buttons.cancel?`<a href="#" id="${r.buttons.cancel.id}" class="button button-cancel">${r.buttons.cancel.label}</a>`:""}\n                    ${r.buttons.ok?`<a href="#" id="${r.buttons.ok.id}" class="button button-confirm">${r.buttons.ok.label}</a>`:""}\n                </div>\n                `:""}\n            </div>\n        </div>\n    `);return r.buttons.cancel&&"function"==typeof r.buttons.cancel.callback&&a.querySelector("#"+r.buttons.cancel.id).addEventListener("click",r.buttons.cancel.callback,!1),r.buttons.ok&&"function"==typeof r.buttons.ok.callback&&a.querySelector("#"+r.buttons.ok.id).addEventListener("click",r.buttons.ok.callback,!1),e("app").append(a),a}j.onAny(((e,...o)=>{console.log(e,o)})),console.log("Setup socket server ","http://192.168.1.111:3000/");class N{static TRANSITION_DELAY=200;constructor(){}static hide(o){const{id:l,timeout:r=400}=o;e(l)&&(e(l).classList.remove("show"),setTimeout((()=>{const o=e(l);o&&o.remove()}),r))}static removePrevious(){let e=document.querySelectorAll(".notification.show").length;if(e>0){let e=200;l(".notification.show",(o=>{N.hide({id:o.id,timeout:e}),e+=200}))}return e}static show(o){const l=N.removePrevious(),r=o=>{"string"==typeof o&&(o={title:o});let{message:l,title:r="No message specified.",timeout:t=4e3,autoHide:a=!1}=o;const c=N.createTemplate(l,r);document.body.append(c),setTimeout((()=>{e(c.id).classList.toggle("show")}),1),a&&setTimeout((()=>{N.hide({id:c.id})}),t)};l>0?setTimeout((()=>{r(o)}),200*l+200):r(o)}static createTemplate(e,l=!1){return t(`\n            <div class="notification" id="${"notification_"+o(5)}">\n                ${l?`\n                <h2>${l}</h2>\n                `:""}\n                ${e?`\n                <p>${e}</p>\n                `:""}\n            </div>\n        `)}}class O{static prefix="kok_";static removeItem(e){return localStorage.removeItem(O.prefix+e)}static setItem(e,o=""){return localStorage.setItem(O.prefix+e,JSON.stringify(o))}static getItem(e,o=!1){let l=localStorage.getItem(O.prefix+e);return null===l?o:JSON.parse(l)}}class D{static render(){return`\n            ${D.renderViewGame()}\n            ${D.renderViewLevelSelect()}\n        `}static renderViewGame(){return'\n            <div id="gameView" class="applicationWindow hidden">\n                <div class="gameViewRows">\n                    <div class="columns">\n                        <div class="jokers" id="jokerContainer"></div>\n                        <div id="blockGrid"></div>\n                        <div class="scoreContainer">\n                            <div class="column" id="scoreColumn">\n                                <div id="scoreColumn1"></div>\n                            </div>\n                            <div class="column" id="scoreColumn2"></div>\n                        </div>\n                    </div>\n                    <div id="gameData">\n                        <ul id="activePlayers" class="blockList playerList"></ul>\n                        <a id="newGameButton">Nieuw spel</a>\n                    </div>\n                </div>\n            </div>\n       '}static renderViewLevelSelect(){return'\n            <div id="levelSelect" class="applicationWindow hidden">\n                <div id="playerContainer">\n                    <h2 class="rainbow">Spelers</h2>\n                    <ul id="players" class="blockList playerList"></ul>\n                    <h2 class="rainbow">Lobby</h2>\n                    <a href="#" id="lobbyCode">Cool</a>\n                </div>\n                <div id="levelContainer">\n                    <h2 class="rainbow">Selecteer een level</h2>\n                    <ul id="levels" class="blockList">\n                        <li class="level">\n                            <a href="#" class="level1" data-level="level1">\n                                <img src="/images/level1.png" alt="level1" />\n                                <span class="label">Level 1</span>\n                            </a>\n                        </li>\n                        <li class="level">\n                            <a href="#" class="level2" data-level="level2">\n                                <img src="/images/level2.png" alt="level2" />\n                                <span class="label">Level 2</span>\n                            </a>\n                        </li>\n                        <li class="level">\n                            <a href="#" class="level3" data-level="level3">\n                                <img src="/images/level3.png" alt="level3" />\n                                <span class="label">Level 3</span>\n                            </a>\n                        </li>\n                        <li class="level">\n                            <a href="#" class="level4" data-level="level4">\n                                <img src="/images/level4.png" alt="level4" />\n                                <span class="label">Level 4</span>\n                            </a>\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        '}static renderPlayer(e){return`<li class="player" data-player="${e.username}" data-player-id="${e.id}">${e.username}</li>`}static renderPlayerAvatar({url:e,playerName:o}){return`<img src="${e}" alt="${o}"/><span>${o}</span>`}}class V{#lobby=!1;state=!1;constructor(e){this.lobby=e,j.on("player:stats",(({player:e})=>{V.setLobbyCodeDom({code:e.lobbyCode})})),j.on("lobby:updated",(({lobby:e})=>{this.lobby=e})),j.once("lobby:joined",(({lobby:e})=>{this.lobby=e})),j.once("lobby:created",(({lobby:e})=>{this.lobby=e})),j.on("player:connected",(({player:e})=>{V.addPlayerToLobby(e)})),j.on("player:disconnected",(({player:e})=>{V.removePlayerFromLobby(e)}))}static loadAvatars(){l("#players .player:not(.avatar), #activePlayers .player:not(.avatar)",(e=>{const o=e.innerText,l=new URL(`https://avatars.dicebear.com/api/bottts/${o}.svg?mood[]=happy`);e.innerHTML=D.renderPlayerAvatar({url:l,playerName:o}),e.classList.add("avatar")}))}static addPlayerToLobby(e){l("#players, #activePlayers",(o=>{o.innerHTML+=D.renderPlayer(e)})),V.loadAvatars()}static removePlayerFromLobby(e){l(`li[data-player="${"string"==typeof e?e:e.username}"]`,(e=>{e.remove()}))}static setPlayers(e){l("#players, #activePlayers",(e=>{e.innerHTML=""})),e.forEach((e=>{V.addPlayerToLobby(e)}))}static async joinOrCreate(e){if(e)j.emit("lobby:join",{lobbyCode:e});else{let e=prompt(c.notification.createLobby,o(4).toUpperCase());e=e.toUpperCase(),j.emit("lobby:create",{lobbyCode:e})}return new Promise(((e,o)=>{j.once("lobby:joined",(({lobby:o})=>{e(new V(o))})),j.once("lobby:created",(({lobby:o})=>{e(new V(o))})),setTimeout((()=>{o("Lobby creation timeout.")}),1e4)}))}static setLobbyCodeDom({code:o}){const l=e("lobbyCode");l&&(l.innerText=o)}static setState(e){j.emit("lobby:state",{key:"state",value:e})}leave(){j.emit("lobby:leave",{lobbyCode:this.code})}get players(){return this.lobby?.players||[]}get code(){return this.lobby?.code}static get cachedLobbyCode(){return O.getItem("lobby",!1)}get state(){return this.lobby?.state}set lobby(e){e.code!==this.#lobby.code&&O.setItem("lobby",e.code),V.setLobbyCodeDom({code:e.code}),e.players.length>0&&V.setPlayers(e.players),this.#lobby=e}get lobby(){return this.#lobby}get playerNames(){return this.players.map((e=>e.username)).join(", ")}static template(e="",o=-1){const l={...M};return l.code=e,l.playerId=o,l}}const M={members:[],playerId:-1,code:"KOK123",data:{columnScores:{A:-1,B:-1,C:-1,D:-1,E:-1,F:-1,G:-1,H:-1,I:-1,J:-1,K:-1,L:-1,M:-1,N:-1,O:-1},colorScores:{high:{yellow:-1,green:-1,blue:-1,red:-1,orange:-1},low:{yellow:-1,green:-1,blue:-1,red:-1,orange:-1}}}},H=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"yellow"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"green"},{color:"red"},{color:"orange"},{color:"blue",star:!0},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow",star:!0},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"green"},{color:"orange"},{color:"red",star:!0},{color:"blue"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"green"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"orange"},{color:"green",star:!0},{color:"blue"},{color:"blue"},{color:"red"},{color:"red"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green",star:!0},{color:"orange"},{color:"red"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"red"},{color:"green"},{color:"orange"},{color:"yellow",star:!0},{color:"yellow"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"green"},{color:"orange"},{color:"orange"},{color:"yellow"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"red",star:!0},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"blue"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"red",star:!0},{color:"red"},{color:"blue"},{color:"orange"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]}],J=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"green",star:!0}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"orange"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"yellow"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"red"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"red"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"green"},{color:"green",star:!0}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"green"},{color:"blue"},{color:"yellow"},{color:"orange",star:!0}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"yellow",star:!0},{color:"blue"},{color:"orange"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"blue"},{color:"blue"},{color:"red",star:!0},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"blue"},{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"orange"},{color:"orange"},{color:"green"}]}],q=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"blue"},{color:"orange"},{color:"green",star:!0},{color:"green"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"green"},{color:"red"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"red",star:!0},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"red"},{color:"yellow",star:!0},{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"green",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"orange"},{color:"orange"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"blue"},{color:"red",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"},{color:"yellow",star:!0},{color:"green"},{color:"green"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"blue",star:!0},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"blue"},{color:"blue"},{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"red"},{color:"red"},{color:"red"},{color:"yellow"}]}],x=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"green"},{color:"green"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"blue"},{color:"yellow",star:!0},{color:"yellow"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"green"},{color:"green"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"red"},{color:"red"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"green",star:!0},{color:"green"},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"orange"},{color:"orange"},{color:"red"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"yellow",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"green"},{color:"red"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"green"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"yellow"},{color:"blue"},{color:"orange",star:!0},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green",star:!0},{color:"red"},{color:"red"},{color:"blue"},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"yellow"},{color:"red",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"red"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"yellow"},{color:"orange",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"red"}]}];class B{selectedLevel=!1;static levelMap={level1:H,level2:J,level3:q,level4:x};constructor(){P(f,(e=>{const{level:o,element:l}=e.detail;B.selectInDom(o,l)})),j.on("level:selected",(({selectedLevel:e})=>{this.level=e,A(i)})),this.registerEventHandlers()}static selectInDom(e,o=!1){const l=document.querySelectorAll("#levels .level a"),r=document.querySelectorAll("#levels .level a."+e)[0];Array.prototype.forEach.call(l,(e=>{e.classList.remove("selected"),document.getElementById("startGame")?.remove()})),r&&(r.classList.toggle("selected"),r.innerHTML+='<span id="startGame">Start Spel &rarr;</span>')}registerEventHandlers(){const e=document.querySelectorAll("li.level > a");Array.prototype.forEach.call(e,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation();const l=e.dataset.level;e.classList.contains("selected")?j.emit("game:start"):(A(f,{level:l}),j.emit("level:select",{selectedLevel:l}))}),!1)}))}reset(){O.removeItem("level"),this.selectedLevel=!1}select({Player:e,Lobby:o}){A(E,{page:"levelSelect"})}set level(e){this.selectedLevel=e,A(f,{level:e})}get level(){return B.levelMap[this.selectedLevel]}}class K{static JOKER_VALUE=1;static STAR_VALUE=-2;constructor(){P(p,(e=>{A(S,{scores:{jokers:this.jokerScore}})})),P(h,(()=>{A(S,{scores:{stars:this.starScore}})})),P(d,(()=>{A(S,{scores:{bonus:this.bonusScore,columns:this.columnScore,jokers:this.jokerScore,stars:this.starScore,total:this.total}})})),P(u,(()=>this.toggleTotalScore())),j.on("grid:column-completed",(({columnLetter:e,player:o,first:l})=>{const r=l?0:1,t=document.querySelectorAll(`.column-score[data-column="${e}"][data-row="${r}"]`)[0];t&&(A(k,{element:t,row:r,column:e}),A(d))}))}static getColumnScoreState(e){return e?e.classList.contains("active")||e.classList.contains("taken")?e.classList.contains("active")&&!e.classList.contains("taken")?"taken":"default":"active":"default"}get total(){return this.bonusScore+this.columnScore+this.jokerScore+this.starScore}get columnScore(){let e=document.querySelectorAll("span.column-score.active"),o=0;return Array.prototype.forEach.call(e,(e=>{let l=parseInt(e.innerText);o+=l})),o}get jokerScore(){let e=document.getElementsByClassName("joker"),o=e.length,l=0;return Array.prototype.forEach.call(e,(e=>{e.classList.contains("used")&&l++})),(o-l)*K.JOKER_VALUE}get bonusScore(){let e=document.querySelectorAll(".final-selected span"),o=0;return Array.prototype.forEach.call(e,(e=>{o+=parseInt(e.innerText)})),o}get starScore(){const e=document.querySelectorAll("span.selected span.star").length;return(document.querySelectorAll("span.star").length-e)*K.STAR_VALUE}toggleTotalScore(){const o=e("totalScore");o.classList.contains("hide")?(o.classList.remove("hide"),this.renderTotalScore()):(o.innerText="",o.classList.add("hide"))}renderBonusScore(o){e("bonusTotal").innerText=o,this.renderTotalScore()}renderColumnScore(o){e("columnsTotal").innerText=o,this.renderTotalScore()}renderJokerScore(o){e("jokerTotal").innerText=o,this.renderTotalScore()}renderStarScore(o){e("starsTotal").innerText=o,this.renderTotalScore()}renderTotalScore(){const o=e("totalScore");o.classList.contains("hide")||(console.log("set total",this.total),o.innerText=this.total)}}class R{constructor(){}static get cachedId(){return O.getItem("sessionId")}static set cachedId(e){return O.setItem("sessionId",e)}}class F{#cachedPlayer=!1;constructor(){const e=R.cachedId;!1!==e?(j.auth={sessionId:e,username:F.cachedName},j.connect()):this.createPlayer(),j.once("player:created",(({player:e})=>{this.player=e})),j.on("player:updated",(({player:e})=>{this.player=e})),j.on("player:stats",(({totalPlayers:e,players:o})=>{F.setPlayerNamesDom({players:o}),F.setPlayerTotalDom({totalPlayers:e})})),j.on("player:connected",(({player:e})=>{N.show({title:c.notification.playerJoined.title,message:c.notification.playerJoined.message(e.username),autoHide:!0})}))}static setPlayerTotalDom({totalPlayers:o}){const l=e("playerTotal");l&&(l.innerText=o)}static setPlayerNamesDom({players:o}){const l=e("playerNames");l&&(l.innerText=o.join(", "))}static setPlayerNameDom({player:o}){const l=e("playerName");l&&(l.innerText=o.username)}createPlayer(){const e=prompt(c.notification.playerName);this.player={username:e},this.connectPlayer(this.player)}connectPlayer(e){console.log("Connecting player!",e),j.auth=e,j.connect()}delete(){return O.removeItem("player")}set player(e){if(!e.username)throw new Error("Invalid player object. No username.");this.#cachedPlayer=e,O.setItem("player",e.username),F.setPlayerNameDom(e.username)}get player(){return this.#cachedPlayer}static get cachedName(){return O.getItem("player")}get name(){return this.#cachedPlayer.username}get id(){return this.#cachedPlayer?.id||o(6).toLowerCase()}}class _{currentView;defaultView="levelSelect";constructor(){this.currentView=document.querySelectorAll(".applicationWindow:not(.hidden)")[0],this.currentView||this.navigate(this.defaultView),P(E,(o=>{const{page:l}=o.detail;e(l)&&this.navigate(l)}))}hideCurrent(){this.currentView&&(A(T,{page:this.currentView}),this.currentView.classList.add("hidden"))}navigate(o){this.hideCurrent(),this.currentView=e(o),this.currentView.classList.remove("hidden"),A(C,{page:this.currentView})}static navigateTo(e){A(E,{page:e})}}class z{static COLORS=["green","yellow","blue","red","orange"];static TOTAL_JOKERS=8;Lobby;Level;Score;Player;#cachedState=!1;constructor(){this.state=O.getItem("state"),this.Player=new F,j.on("game:start",(()=>{A(s)})),j.on("lobby:updated",(({lobby:e})=>{e.state})),j.on("connect",(()=>{this.initialize()})),P(i,(()=>{this.state=this.createState()})),P(n,(()=>{this.new()})),P(s,(()=>{this.continue()})),P(k,(({element:e,row:o,column:l})=>{this.updateState(l,o,"state",K.getColumnScoreState(e),"score")}))}initialize(){V.joinOrCreate(V.cachedLobbyCode).then((e=>{this.Lobby=e,this.Level=new B({Lobby:e,Game:this}),this.Score=new K,this.start()})).catch((e=>{console.error("Failed to create lobby",e)}))}start(){this.state&&this.continue()}new(){this.resetState(),_.navigateTo("levelSelect"),this.start()}continue(){this.state=O.getItem("state"),_.navigateTo("gameView"),A(w)}resetState(){this.Level.reset(),this.state=!1}createState(){let e,o={grid:this.Level.level,jokers:[],colorScores:{high:[],low:[]}};for(e=0;e<z.TOTAL_JOKERS;e++)o.jokers.push({selected:!1});return z.COLORS.forEach((e=>{o.colorScores.high.push({color:e,value:0}),o.colorScores.low.push({color:e,value:0})})),o}get state(){return this.#cachedState||(this.#cachedState=O.getItem("state",!1)),this.#cachedState}set state(e){this.#cachedState=e,e?O.setItem("state",e):(console.log("Clearing local state"),O.removeItem("state"))}updateState(e,o,l,r,t="grid"){let a=this.state,c=!1;a.grid.forEach(((n,s)=>{n.column===e&&(a.grid[s][t][o][l]=r,c=!0)})),c&&(this.state=a,A(w))}updateBlockState(e,o,l,r){let t=this.state,a=!1;t.grid.forEach(((c,n)=>{c.column===e&&(t.grid[n].grid[o][l]=r,a=!0)})),a&&(this.state=t,A(w))}updateJokerState(e,o){let l=this.state,r=!1;l.jokers.forEach(((l,t)=>{t===e&&(l.selected=o,r=!0)})),r&&(this.state=l,A(w))}updateColorScoreState(e,o,l){let r=!1,t=this.state;t.colorScores[e].forEach((e=>{e.color===o&&(e.value=l,r=!0)})),r&&(this.state=t,A(w))}}class U{currentGame=!1;application;version;constructor(){e("app").innerHTML+=D.render(),this.application=new _,P(g,(o=>{const{modalId:l}=o.detail;e(l)&&e(l).classList.toggle("show")})),P(m,(o=>{const{modalId:l}=o.detail;e(l)&&e(l).classList.contains("show")&&e(l).classList.remove("show")})),P(v,(o=>{const{modalId:l}=o.detail;e(l)&&!e(l).classList.contains("show")&&e(l).classList.add("show")})),this.currentGame=new z,this.parseOrientationOverlay(),this.parseGenericLoading(),e("connecting-message").innerText=c.messages.connecting,P(L,(()=>{A(v,{modalId:"genericLoading"})})),P(w,(()=>{this.render()})),P(S,(e=>{const{scores:o}=e.detail,l=this.currentGame.Score;void 0!==o.bonus&&l.renderBonusScore(o.bonus),void 0!==o.columns&&l.renderColumnScore(o.columns),void 0!==o.jokers&&l.renderJokerScore(o.jokers),void 0!==o.stars&&l.renderStarScore(o.stars)})),j.on("grid:column-completed",(({columnLetter:e,player:o})=>{})),j.on("version",(e=>{O.setItem("version",e)})),j.on("session",(({sessionId:e})=>{R.cachedId=e})),j.on("connect",(()=>{document.body.classList.toggle("connected")})),j.on("disconnect",(()=>{document.body.classList.toggle("connected")}))}parseOrientationOverlay(){G({id:"orientationModal",message:c.notification.landscapeMode})}parseGenericLoading(){G({visible:!1,id:"genericLoading",message:"Aan het laden.. een moment geduld."})}parseColumnGrid(o){const l=e("blockGrid");l.innerHTML="",o.grid.forEach((e=>{l.innerHTML+=this.parseColumn(e)}));let r=document.querySelectorAll(".score-block:not(.final-score)");Array.prototype.forEach.call(r,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation();let l=!e.classList.contains("selected");this.currentGame.updateBlockState(e.dataset.column,e.dataset.row,"selected",l),A(b,{selected:l,block:e}),e.querySelectorAll(".star").length>0&&A(h,{selected:l,block:e})}),!1)}))}parseJokerColumn(o){e("jokerContainer").innerHTML=o.jokers.map((e=>`<span class="joker${e.selected?" used":""}">!</span>`)).join("");let l=document.getElementsByClassName("joker");Array.prototype.forEach.call(l,((e,o)=>{e.addEventListener("click",(l=>{l.preventDefault(),l.stopPropagation();let r=!e.classList.contains("used");this.currentGame.updateJokerState(o,r),A(p,{joker:e,selected:r})}),!1)}))}parseScoreColumns(o){e("scoreColumn1").innerHTML=o.colorScores.high.map((e=>{return`<span class="score-block final-score ${e.color}${o=e.value,-1===o?" selected":5===o?" final-selected":""}"><span>5</span></span>`;var o})).join(""),e("scoreColumn2").innerHTML="",o.colorScores.low.forEach((o=>{let l=r("span",{className:"score-block final-score "+o.color});-1===o.value&&l.classList.add("selected"),3===o.value&&l.classList.add("final-selected"),r("span",{innerText:3},l),e("scoreColumn2").append(l)}));let l=function(e,o=5,l=-1){return e.classList.contains("final-selected")||e.classList.contains("selected")?e.classList.contains("final-selected")&&!e.classList.contains("selected")?l:0:o},t=function(e){let o="";return z.COLORS.forEach((l=>{e.classList.contains(l)&&(o=l)})),o},a=document.querySelectorAll("#scoreColumn1 .final-score");Array.prototype.forEach.call(a,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation(),this.currentGame.updateColorScoreState("high",t(e),l(e,5,-1)),A(d)}),!1)}));let c=document.querySelectorAll("#scoreColumn2 .final-score");Array.prototype.forEach.call(c,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation(),this.currentGame.updateColorScoreState("low",t(e),l(e,3,-1)),A(d)}),!1)}));let n=document.querySelectorAll("span.column-score");Array.prototype.forEach.call(n,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation(),A(k,{column:e.dataset.column,element:e}),A(d)}),!1)}))}parseGrid(){this.parseColumnGrid(this.currentGame.state),this.parseJokerColumn(this.currentGame.state),this.parseScoreColumns(this.currentGame.state),A(y)}parseTotalScores(){if(e("totalScores"))return;const o=`\n            <div id="totalScores">\n                <div class="totals" id="bonus"><label class="rainbow">${c.label.bonus}</label><span class="label">=</span><span id="bonusTotal" class="totalValue">15</span></div>\n                <div class="totals" id="columns"><label>${c.label.columns}</label><span class="label">+</span><span id="columnsTotal" class="totalValue"></span></div>\n                <div class="totals" id="jokers"><label>${c.label.jokers}</label><span class="label">+</span><span id="jokerTotal" class="totalValue"></span></div>\n                <div class="totals" id="stars"><label>${c.label.stars}</label><span class="label">-</span><span id="starsTotal" class="totalValue"></span></div>\n                <div class="totals" id="totals">\n                    <label>${c.label.totals}</label><span class="label">&nbsp;</span><span id="totalScore" class="totalValue hide"></span>\n                </div>\n            </div>\n        `;e("scoreColumn").innerHTML+=o,e("totals").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),A(u)}),!1)}renderNewGameButton(o){const l="newGameButton";if(e(l))return;const r=function(e={}){const o={callback:()=>!1,className:"button",...e};let l=t(`<a>${o.label}</a>`);return o.callback&&"function"==typeof o.callback&&l.addEventListener("click",o.callback,!1),o.className&&(l.className=o.className),o.id&&(l.id=o.id),l}({callback:o,id:l,label:c.label.newGame,className:"new-game"});return e("gameView").append(r),r}render(o){this.parseGrid(o),this.parseTotalScores();const l="newGameModal";e(l)||function({modalId:e="newGameModal"}){G({id:e,message:c.modal.newGame.body,buttons:{cancel:{id:e+"Cancel",label:c.label.cancel,callback(o){o.preventDefault(),A(g,{modalId:e})}},ok:{id:e+"Confirm",label:c.label.ok,callback(o){o.preventDefault(),A(g,{modalId:e}),A(n)}}}})}({modalId:l}),this.renderNewGameButton((e=>{e.preventDefault(),A(v,{modalId:l})})),A(d)}parseColumn(e){let o=e.grid.length,l=0,r=`\n            <div class="column${"H"===e.column?" highlight":""}">\n                <span class="rounded-block" data-letter="${e.column}">${e.column}</span>\n                ${function(o){return o.map(((o,r)=>(o.selected&&l++,`\n                    <span class="score-block${o.selected?" selected":""} ${o.color}" data-column="${e.column}" data-row="${r}">\n                        ${o.star?'<span class="star">*</span>':""}\n                    </span>\n                `))).join("")}(e.grid)}\n                <div class="column-score">${t=e.score,t.map(((o,l)=>`<span class="rounded-block column-score${o.state&&"default"!==o.state?" "+o.state:""}" data-column="${e.column}" data-row="${l}">${o.value}</span>`)).join("")}</div>\n            </div>\n        `;var t;return o===l&&j.emit("grid:column-complete",{columnLetter:e.column}),r}}try{new U}catch(e){console.error("Failed to load game. Reset state!",e)}
