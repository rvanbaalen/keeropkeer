function e(e){return document.getElementById(e)}function o(e=6){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,e)}function l(e,o){Array.prototype.forEach.call(document.querySelectorAll(e),o)}function t(e){const o=document.createElement("div");return o.innerHTML=e,o.firstElementChild}function r(e){let o=function(e,o={},l){let t=document.createElement(e);return Object.keys(o).forEach((function(e){t[e]=o[e]})),l&&l.append(t),t}("div");return o.innerHTML=e,o.firstElementChild}var a={modal:{newGame:{body:"Weet je zeker dat je een nieuw spel wil beginnen?"}},label:{cancel:"Annuleren",ok:"OK",newGame:"Nieuw spel",bonus:"bonus",columns:"A-O",stars:"Sterren",totals:"Totaal",jokers:"Jokers",startGame:"Start Spel"},messages:{connecting:"Bezig met verbinden ..."},notification:{landscapeMode:"Draai het scherm horizontaal om te beginnen.",selectLevel:"Selecteer een level.",playerName:"Wat is je naam?",createLobby:"Kies een spelcode:",creatingLobby:"Bezig met het aanmaken van de lobby...",playerJoined:{title:"Een speler is verbonden",message:(e="onbekend")=>`${e} speelt mee!`}}};document.querySelector("body").classList.add("lang-nl");const c=a,s="game-new",n="game-start",i="game-create-state",d="score-reload",u="score-total-toggle",m="modal-toggle",g="modal-hide",v="modal-show",h="grid-render-complete",p="joker-selected",b="star-selected",y="render-level",w="loading",S="navigate-from",k="navigate-to",L="navigate",T="navigate-back",f="score-column-claim",E="score-column-update",C="block-selected",A="update-grid-block",$=e("app");function I(e,o){let l=new CustomEvent(e,{detail:o});$.dispatchEvent(l)}function P(e,o,l=!1){$.addEventListener(e,o,!1)}function j(l){let t={...{id:"modal-"+o(),message:"No modal message is set.",buttons:!1,appendTo:"#app",visible:!1},...l};!0===t.buttons&&(t.buttons={cancel:{id:t.id+"-cancel",label:c.label.cancel},ok:{id:t.id+"-ok",label:c.label.ok}});let a=r(`\n        <div class="modal-overlay${t.visible?" show":""}" id="${t.id}"${t.selfDestruct?' data-selfDestruct="true"':""}>\n            <div class="modal-container">\n                ${t.title?`\n                <div class="modal-title">\n                    <h2>${t.title}</h2>\n                </div>\n                `:""}\n                ${t.body&&!t.message?t.body:`\n                <div class="modal-body">\n                    <p>${t.message}</p>\n                </div>\n                `}\n                ${t.buttons?`\n                <div class="modal-button-bar">\n                    ${t.buttons.cancel?`<a href="#" id="${t.buttons.cancel.id}" class="button button-cancel">${t.buttons.cancel.label}</a>`:""}\n                    ${t.buttons.ok?`<a href="#" id="${t.buttons.ok.id}" class="button button-confirm">${t.buttons.ok.label}</a>`:""}\n                </div>\n                `:""}\n            </div>\n        </div>\n    `);return t.buttons.cancel&&"function"==typeof t.buttons.cancel.callback&&a.querySelector("#"+t.buttons.cancel.id).addEventListener("click",t.buttons.cancel.callback,!1),t.buttons.ok&&"function"==typeof t.buttons.ok.callback&&a.querySelector("#"+t.buttons.ok.id).addEventListener("click",t.buttons.ok.callback,!1),e("app").append(a),a}const G=(0,window.io)("https://dry-peak-80209.herokuapp.com/",{autoConnect:!1});G.onAny(((e,...o)=>{console.log(e,o)})),console.log("Setup socket server ","https://dry-peak-80209.herokuapp.com/");class N{static prefix="kok_";static removeItem(e){return localStorage.removeItem(N.prefix+e)}static setItem(e,o=""){return localStorage.setItem(N.prefix+e,JSON.stringify(o))}static getItem(e,o=!1){let l=localStorage.getItem(N.prefix+e);return null===l?o:JSON.parse(l)}}const O=new WeakMap;function D(e,o,l,t){var r,a;if(!e&&!O.has(o))return!1;const c=null!==(r=O.get(o))&&void 0!==r?r:new WeakMap;if(O.set(o,c),!e&&!O.has(o))return!1;const s=null!==(a=c.get(l))&&void 0!==a?a:new Set;c.set(l,s);const n=s.has(t);return e?s.add(t):s.delete(t),n&&e}function V(e,o,l,t,r){if("string"==typeof e&&(e=document.querySelectorAll(e)),"function"!=typeof e.addEventListener){const a=Array.prototype.map.call(e,(e=>V(e,o,l,t,r)));return{destroy(){for(const e of a)e.destroy()}}}const a=e instanceof Document?e.documentElement:e,c=Boolean("object"==typeof r?r.capture:r),s=e=>{const l=function(e,o){let l=e.target;if(l instanceof Text&&(l=l.parentElement),l instanceof Element&&e.currentTarget instanceof Element){const t=l.closest(o);if(t&&e.currentTarget.contains(t))return t}}(e,o);l&&(e.delegateTarget=l,t.call(a,e))},n=JSON.stringify({selector:o,type:l,capture:c}),i={destroy(){a.removeEventListener(l,s,r),D(!1,a,t,n)}};return D(!0,a,t,n)||a.addEventListener(l,s,r),i}class M{template=!1;state={};constructor({letter:e,row:o,color:l,selected:t=!1,element:r}){this.template=r,this.letter=e,this.row=o,this.color=l,this.selected=t}get letter(){return this.state?.letter}get row(){return this.state?.row}get color(){return this.state?.color}get selected(){return!!this.state?.selected}set letter(e){this.state.letter=e}set row(e){this.state.row=parseInt(e)}set color(e){this.state.color=e}set selected(e){e!==this.state.selected&&(this.state.selected=!!e,this.onSelected())}get selectedClass(){return"selected"}onSelected(){this.element&&this.selected&&(this.element.classList.add(this.selectedClass),I(C,{block:this})),this.element&&!this.selected&&this.element.classList.remove(this.selectedClass)}set element(e){"string"==typeof e&&(e=t(e)),this.template=e}get element(){return this.template}render(){const e=`\n            <span \n                class="score-block${this.selected?" selected":""}" \n                data-letter="${this.letter}" \n                data-row="${this.row}" \n                data-color="${this.color}">\n            </span>\n        `;return this.element=e,e}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const o=e.classList.contains("selected"),{letter:l,row:t,color:r}=e.dataset;return new M({letter:l,row:t,color:r,selected:o})}static getByProperties({letter:e,row:o}){return document.querySelector(`[data-letter="${e}"][data-row="${o}"]`)}}class B extends M{constructor({letter:e,row:o,color:l,star:t=!1,selected:r=!1,element:a}){super({letter:e,row:o,color:l,selected:r,element:a}),this.state.star=t}render(){const e=`\n            <span \n                class="score-block${this.selected?" selected":""}"\n                data-type="score-block" \n                data-letter="${this.letter}" \n                data-row="${this.row}" \n                data-color="${this.color}">\n                ${this.star?'<span class="star">*</span>':""}    \n            </span>\n        `;return this.element=e,V("#app",`[data-type="score-block"][data-letter="${this.letter}"][data-row="${this.row}"]`,"click",(e=>{this.refresh(),this.onClick({event:e})})),e}refresh(){this.element=document.querySelector(`[data-type="score-block"][data-letter="${this.letter}"][data-row="${this.row}"]`)}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.selected=!this.selected,I(A,{gridBlock:this}),U.setColumnScoreState({letter:this.letter,shouldEmit:!0}),I(E)}get star(){return this.state?.star}set star(e){this.state.star=!!e}onSelected(){super.onSelected(),this.star&&I(b,{selected:this.selected,block:this})}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const o=!!e.querySelector("span.star"),l=e.classList.contains("selected"),{letter:t,row:r,color:a}=e.dataset;return new B({letter:t,row:r,color:a,star:o,selected:l,element:e})}}class q extends M{static TYPE_COLUMN_SCORE="column-score";static TYPE_COLOR_SCORE="color-score";static TYPE_JOKER="joker";#DEFAULT_VALUE=0;constructor({letter:e,row:o,color:l,selected:t=!1,element:r,value:a=0,type:c}){super({letter:e,row:o,color:l,selected:t,element:r}),this.type=c,this.value=a}set value(e){isNaN(e)&&(e=this.#DEFAULT_VALUE),this.state.value=e}get value(){return this.state?.value||this.#DEFAULT_VALUE}set type(e){this.state.type=e}get type(){return this.state?.type}}class _ extends q{static STATE={DEFAULT:"default",ACTIVE:"active",TAKEN:"taken"};cache;constructor({state:e=_.STATE.DEFAULT,letter:o,row:l=-1,color:t="white",selected:r=!1,element:a,value:c=0}){if(super({letter:o,row:l,color:t,selected:r,element:a,value:c,type:q.TYPE_COLUMN_SCORE}),!o||-1===l)throw new Error("Need letter and row for new block instance.");let s=this.storage[o+l];e=s!==_.STATE.DEFAULT?s:e,this.blockState=e}set storage(e){N.setItem("columnScore",e),this.cache=e}get storage(){return this.cache?this.cache:N.getItem("columnScore",{})}set blockState(e){e=-1===Object.values(_.STATE).indexOf(e)?_.STATE.DEFAULT:e,this.state.blockState=e,this.element&&(Object.values(_.STATE).forEach((e=>this.element.classList.remove(e))),this.element.classList.add(e));let o=this.storage;o[this.letter+this.row]=e,this.storage=o}get blockState(){return this.state?.blockState}render(){const e=`\n            <span \n                class="rounded-block column-score${this.blockState!==_.STATE.DEFAULT?" "+this.blockState:""}" \n                data-letter="${this.letter}" \n                data-row="${this.row}"\n                data-type="${this.type}">\n                    ${this.value}\n            </span>\n        `;return this.element=e,V("#app",`[data-type="${this.type}"][data-letter="${this.letter}"][data-row="${this.row}"]`,"click",(e=>{this.onClick({event:e})})),e}toggleState(){const{letter:e,type:o,row:l}=this;switch(this.element=_.getElementByProperties({letter:e,type:o,row:l}),this.blockState){case _.STATE.DEFAULT:this.active();break;case _.STATE.ACTIVE:this.row>0?this.default():this.taken();break;case _.STATE.TAKEN:this.default()}}isHighScore(){return 0===this.row}isTaken(){return this.blockState===_.STATE.TAKEN}isActive(){return this.blockState===_.STATE.ACTIVE}taken(){this.blockState=_.STATE.TAKEN}active(){this.blockState=_.STATE.ACTIVE}default(){this.blockState=_.STATE.DEFAULT}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.refresh(),this.toggleState()}refresh(){this.element=_.getElementByProperties({letter:this.letter,row:this.row}),this.state.blockState=_.getStateFromClassList(this.element)}static getStateFromClassList(e){return e.classList.contains("active")?_.STATE.ACTIVE:e.classList.contains("taken")?_.STATE.TAKEN:_.STATE.DEFAULT}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const{letter:o,row:l,color:t}=e.dataset;return new _({letter:o,row:l,color:t,element:e})}static getElementByProperties({letter:e,row:o=0}){return document.querySelector(`[data-type="${q.TYPE_COLUMN_SCORE}"][data-letter="${e}"][data-row="${o}"]`)}static getFirstAvailable({letter:e}){const o=document.querySelector(`[data-type="${q.TYPE_COLUMN_SCORE}"][data-letter="${e}"]:not(.${_.STATE.ACTIVE}):not(.${_.STATE.TAKEN})`);return!!o&&_.getInstance(o)}static getAll({letter:e}){return[...document.querySelectorAll(`[data-type="${q.TYPE_COLUMN_SCORE}"][data-letter="${e}"]`)].map((e=>_.getInstance(e)))}}class H extends q{constructor({joker:e,row:o,element:l}){const t=q.TYPE_JOKER;super({letter:"X",row:o,color:"green",selected:e.selected||!1,element:l,value:0,type:t})}render(){const e=`<span class="joker${this.selected?" used":""}" data-type="joker" data-row="${this.row}">!</span>`;return this.element=e,V("#app",`[data-type="joker"][data-row="${this.row}"]`,"click",(e=>{this.refresh(),this.onClick({event:e})})),e}refresh(){this.element=document.querySelector(`[data-type="joker"][data-row="${this.row}"]`)}get selectedClass(){return"used"}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.selected=!this.selected,I(p,{joker:this})}}class U{static setColumnScoreState({letter:e,shouldEmit:o=!1}){U.isColumnComplete({letter:e})?U.toggleCompletedColumn({letter:e,shouldEmit:o}):U.clearColumnScore({letter:e,shouldEmit:o})}static toggleCompletedColumn({letter:e,shouldEmit:o=!1}){if(0===_.getAll({letter:e}).filter((e=>e.isActive())).length){let l=_.getFirstAvailable({letter:e});l?.active(),l.isHighScore()&&o&&G.emit("grid:column-complete",{letter:e})}}static clearColumnScore({letter:e,shouldEmit:o=!1}){_.getAll({letter:e}).forEach((l=>{l.isActive()&&(l.default(),l.isHighScore()&&o&&G.emit("grid:column-clear",{letter:e}))}))}static jokerHandler({joker:e,currentGame:o,index:l,event:t}){}static isColumnComplete({letter:e,parent:o=document}){const l=o.querySelectorAll(`[data-letter="${e}"]`)[0]?.parentElement;return 7===l.querySelectorAll(".score-block.selected").length}}class J{static render(){return`\n            ${J.renderViewGame()}\n            ${J.renderViewLevelSelect()}\n        `}static applicationWindow(e,o){return`\n            <div id="${e}" class="applicationWindow hidden">${o}</div>\n        `}static renderViewGame(){return J.applicationWindow("gameView",'\n            <div class="gameViewRows">\n                <div class="columns">\n                    <div class="jokers" id="jokerContainer"></div>\n                    <div id="blockGrid"></div>\n                    <div class="scoreContainer">\n                        <div class="column" id="scoreColumn">\n                            <div id="scoreColumn1"></div>\n                        </div>\n                        <div class="column" id="scoreColumn2"></div>\n                    </div>\n                </div>\n                <div id="gameData">\n                    <div>\n                        <h2 class="rainbow">Spelers</h2>\n                        <ul id="activePlayers" class="blockList playerList"></ul>\n                    </div>\n                    <a id="newGameButton">Nieuw spel</a>\n                </div>\n            </div>\n       ')}static renderViewChangeLobby(){return J.applicationWindow("changeLobby",'\n            <div class="gameViewRows">\n                <div class="columns">\n                    <div class="jokers" id="jokerContainer"></div>\n                    <div id="blockGrid"></div>\n                    <div class="scoreContainer">\n                        <div class="column" id="scoreColumn">\n                            <div id="scoreColumn1"></div>\n                        </div>\n                        <div class="column" id="scoreColumn2"></div>\n                    </div>\n                </div>\n                <div id="gameData">\n                    <ul id="activePlayers" class="blockList playerList"></ul>\n                    <a id="newGameButton">Nieuw spel</a>\n                </div>\n            </div>\n       ')}static renderViewLevelSelect(){return J.applicationWindow("levelSelect",'\n            <div id="playerContainer">\n                <h2 class="rainbow">Spelers</h2>\n                <ul id="players" class="blockList playerList"></ul>\n                <h2 class="rainbow">Lobby</h2>\n                <a href="#" id="lobbyCode">Cool</a>\n            </div>\n            <div id="levelContainer">\n                <h2 class="rainbow">Selecteer een level</h2>\n                <ul id="levels" class="blockList">\n                    <li class="level">\n                        <a href="#" class="level1" data-level="level1">\n                            <img src="/images/level1.png" alt="level1" />\n                            <span class="label">Level 1</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level2" data-level="level2">\n                            <img src="/images/level2.png" alt="level2" />\n                            <span class="label">Level 2</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level3" data-level="level3">\n                            <img src="/images/level3.png" alt="level3" />\n                            <span class="label">Level 3</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level4" data-level="level4">\n                            <img src="/images/level4.png" alt="level4" />\n                            <span class="label">Level 4</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        ')}static renderPlayer({player:e}){return`<li class="player" data-player="${e.username}" data-player-id="${e.userId}">${e.username}</li>`}static renderPlayerAvatar({url:e,playerName:o}){return`<img src="${e}" alt="${o}"/><span>${o}</span>`}static renderJokers({jokers:o}){e("jokerContainer").innerHTML=o.map(((e,o)=>new H({joker:e,row:o}).render())).join("")}static renderGrid({columns:o}){const l=e("blockGrid");l.innerHTML="",o.forEach((e=>{l.append(J.renderGridColumn({column:e})),U.setColumnScoreState({letter:e.column,shouldEmit:!1})}))}static renderGridColumn({column:e}){const o=e.column;return t(`\n            <div class="column${"H"===e.column?" highlight":""}">\n                <span class="rounded-block header" data-letter="${o}">${o}</span>\n                ${J.renderGridColumnBlocks({blocks:e.grid,column:e})}\n                ${J.renderColumnScores({column:e})}\n            </div>\n        `)}static renderGridColumnBlocks({blocks:e,column:o}){return e.map(((e,l)=>new B({letter:o.column,row:l,color:e.color,star:e.star,selected:e.selected}).render())).join("")}static renderColumnScores({column:e}){return`<div class="column-score">${e.score.map(((o,l)=>{const{value:t,state:r}=o,a=e.column;return new _({letter:a,row:l,value:t,state:r}).render()})).join("")}</div>`}}class x{#lobby=!1;state=!1;constructor(e){this.lobby=e,G.on("player:stats",(({player:e})=>{x.setLobbyCodeDom({code:e.lobbyCode})})),G.on("lobby:updated",(({lobby:e})=>{this.lobby=e})),G.once("lobby:joined",(({lobby:e})=>{this.lobby=e})),G.once("lobby:created",(({lobby:e})=>{this.lobby=e})),G.on("player:connected",(({player:e})=>{x.addPlayerToLobby(e)})),G.on("player:disconnected",(({player:e})=>{x.removePlayerFromLobby(e)}))}static loadAvatars(){l("#players .player:not(.avatar), #activePlayers .player:not(.avatar)",(e=>{const o=e.innerText,l=new URL(`https://avatars.dicebear.com/api/bottts/${o}.svg?mood[]=happy`);e.innerHTML=J.renderPlayerAvatar({url:l,playerName:o}),e.classList.add("avatar")}))}static getPlayerElement(e){return document.querySelectorAll(`[data-player-id="${e.userId}"]`)[0]}static addPlayerToLobby(e){x.getPlayerElement(e)||(l("#players, #activePlayers",(o=>{o.innerHTML+=J.renderPlayer({player:e})})),x.loadAvatars())}static removePlayerFromLobby(e){const o=x.getPlayerElement(e);o&&o.remove()}static setPlayers(e){l("#players, #activePlayers",(e=>{e.innerHTML=""})),e.length>0&&e.forEach((e=>{x.addPlayerToLobby(e)}))}static async joinOrCreate(e){if(e)G.emit("lobby:join",{lobbyCode:e});else{let e=prompt(c.notification.createLobby,o(4).toUpperCase());e=e.toUpperCase(),G.emit("lobby:create",{lobbyCode:e})}return new Promise(((e,o)=>{G.once("lobby:joined",(({lobby:o})=>{e(new x(o))})),G.once("lobby:created",(({lobby:o})=>{e(new x(o))})),setTimeout((()=>{o("Lobby creation timeout.")}),1e4)}))}static setLobbyCodeDom({code:o}){const l=e("lobbyCode");l&&(l.innerText=o)}static setState(e){G.emit("lobby:state",{key:"state",value:e})}leave(){G.emit("lobby:leave",{lobbyCode:this.code})}get players(){return this.lobby?.players||[]}get code(){return this.lobby?.code}static get cachedLobbyCode(){return N.getItem("lobby",!1)}get state(){return this.lobby?.state}set lobby(e){e.code!==this.#lobby.code&&N.setItem("lobby",e.code),x.setLobbyCodeDom({code:e.code}),e.players.length>0&&x.setPlayers(e.players),this.#lobby=e}get lobby(){return this.#lobby}get playerNames(){return this.players.map((e=>e.username)).join(", ")}}const F=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"yellow"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"green"},{color:"red"},{color:"orange"},{color:"blue",star:!0},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow",star:!0},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"green"},{color:"orange"},{color:"red",star:!0},{color:"blue"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"green"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"orange"},{color:"green",star:!0},{color:"blue"},{color:"blue"},{color:"red"},{color:"red"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green",star:!0},{color:"orange"},{color:"red"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"red"},{color:"green"},{color:"orange"},{color:"yellow",star:!0},{color:"yellow"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"green"},{color:"orange"},{color:"orange"},{color:"yellow"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"red",star:!0},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"blue"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"red",star:!0},{color:"red"},{color:"blue"},{color:"orange"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]}],R=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"green",star:!0}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"orange"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"yellow"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"red"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"red"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"green"},{color:"green",star:!0}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"green"},{color:"blue"},{color:"yellow"},{color:"orange",star:!0}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"yellow",star:!0},{color:"blue"},{color:"orange"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"blue"},{color:"blue"},{color:"red",star:!0},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"blue"},{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"orange"},{color:"orange"},{color:"green"}]}],K=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"blue"},{color:"orange"},{color:"green",star:!0},{color:"green"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"green"},{color:"red"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"red",star:!0},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"red"},{color:"yellow",star:!0},{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"green",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"orange"},{color:"orange"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"blue"},{color:"red",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"},{color:"yellow",star:!0},{color:"green"},{color:"green"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"blue",star:!0},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"blue"},{color:"blue"},{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"red"},{color:"red"},{color:"red"},{color:"yellow"}]}],z=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"green"},{color:"green"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"blue"},{color:"yellow",star:!0},{color:"yellow"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"green"},{color:"green"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"red"},{color:"red"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"green",star:!0},{color:"green"},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"orange"},{color:"orange"},{color:"red"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"yellow",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"green"},{color:"red"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"green"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"yellow"},{color:"blue"},{color:"orange",star:!0},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green",star:!0},{color:"red"},{color:"red"},{color:"blue"},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"yellow"},{color:"red",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"red"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"yellow"},{color:"orange",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"red"}]}];class W{selectedLevel=!1;static levelMap={level1:F,level2:R,level3:K,level4:z};constructor(){G.on("level:selected",(({selectedLevel:e})=>{this.level=e})),this.registerEventHandlers()}static selectInDom(e){const o=document.querySelectorAll("#levels .level a."+e)[0];l("#levels .level a",(e=>{e.classList.remove("selected"),document.getElementById("startGame")?.remove()})),o&&(o.classList.toggle("selected"),o.innerHTML+=`<span id="startGame">${c.label.startGame} &rarr;</span>`)}registerEventHandlers(){const e=document.querySelectorAll("li.level > a");Array.prototype.forEach.call(e,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation();const l=e.dataset.level;e.classList.contains("selected")?G.emit("game:start"):(this.level=l,G.emit("level:select",{selectedLevel:l}))}),!1)}))}reset(){this.level=!1}getGrid(){return W.levelMap[this.level]}set level(e){if(!1===e)return N.removeItem("level"),void(this.selectedLevel=e);e!==this.selectedLevel&&(this.selectedLevel=e,I(i),W.selectInDom(e)),N.setItem("level",this.selectedLevel)}get level(){let e=this.selectedLevel;return e||(e=N.getItem("level")),e}}class Y{static JOKER_VALUE=1;static STAR_VALUE=-2;Game;constructor({Game:e}){this.Game=e,e.initialized||(P(p,(()=>{this.renderScores({scores:{jokers:this.jokerScore}})})),P(b,(()=>{this.renderScores({scores:{stars:this.starScore}})})),P(d,(()=>{this.renderScores({scores:{bonus:this.bonusScore,columns:this.columnScore,jokers:this.jokerScore,stars:this.starScore,total:this.total}})})),P(u,(()=>this.toggleTotalScore())),P(E,(e=>{this.renderColumnScore(this.columnScore)}))),G.on("grid:column-completed",(({letter:e})=>{_.getAll({letter:e}).filter((e=>e.isHighScore()&&!e.active())).forEach((e=>e.taken()))})),G.on("grid:column-cleared",(({letter:e})=>{_.getAll({letter:e}).filter((e=>e.isTaken())).forEach((e=>e.default()))}))}renderScores({scores:e}){void 0!==e.bonus&&this.renderBonusScore(e.bonus),void 0!==e.columns&&this.renderColumnScore(e.columns),void 0!==e.jokers&&this.renderJokerScore(e.jokers),void 0!==e.stars&&this.renderStarScore(e.stars)}get total(){return this.bonusScore+this.columnScore+this.jokerScore+this.starScore}get columnScore(){let e=document.querySelectorAll("span.column-score.active"),o=0;return Array.prototype.forEach.call(e,(e=>{let l=parseInt(e.innerText);o+=l})),o}get jokerScore(){let e=document.getElementsByClassName("joker"),o=e.length,l=0;return Array.prototype.forEach.call(e,(e=>{e.classList.contains("used")&&l++})),(o-l)*Y.JOKER_VALUE}get bonusScore(){let e=document.querySelectorAll(".final-selected span"),o=0;return Array.prototype.forEach.call(e,(e=>{o+=parseInt(e.innerText)})),o}get starScore(){const e=document.querySelectorAll("span.selected span.star").length;return(document.querySelectorAll("span.star").length-e)*Y.STAR_VALUE}toggleTotalScore(){const o=e("totalScore");o.classList.contains("hide")?(o.classList.remove("hide"),this.renderTotalScore()):(o.innerText="",o.classList.add("hide"))}renderBonusScore(o){e("bonusTotal").innerText=o,this.renderTotalScore()}renderColumnScore(o){e("columnsTotal").innerText=o,this.renderTotalScore()}renderJokerScore(o){e("jokerTotal").innerText=o,this.renderTotalScore()}renderStarScore(o){e("starsTotal").innerText=o,this.renderTotalScore()}renderTotalScore(){const o=e("totalScore");o.classList.contains("hide")||(console.log("set total",this.total),o.innerText=this.total)}}class X{static TRANSITION_DELAY=200;constructor(){}static hide(o){const{id:l,timeout:t=400}=o;e(l)&&(e(l).classList.remove("show"),setTimeout((()=>{const o=e(l);o&&o.remove()}),t))}static removePrevious(){let e=document.querySelectorAll(".notification.show").length;if(e>0){let e=200;l(".notification.show",(o=>{X.hide({id:o.id,timeout:e}),e+=200}))}return e}static show(o){const l=X.removePrevious(),t=o=>{"string"==typeof o&&(o={title:o});let{message:l,title:t="No message specified.",timeout:r=4e3,autoHide:a=!1}=o;const c=X.createTemplate(l,t);e("app").append(c),setTimeout((()=>{e(c.id).classList.toggle("show")}),1),a&&setTimeout((()=>{X.hide({id:c.id})}),r)};l>0?setTimeout((()=>{t(o)}),200*l+200):t(o)}static createTemplate(e,l=!1){return r(`\n            <div class="notification" id="${"notification_"+o(5)}">\n                ${l?`\n                <h2>${l}</h2>\n                `:""}\n                ${e?`\n                <p>${e}</p>\n                `:""}\n            </div>\n        `)}}class Q{constructor(){}static get cachedId(){return N.getItem("sessionId")}static set cachedId(e){return N.setItem("sessionId",e)}}class Z{#cachedPlayer=!1;constructor(){const e=Q.cachedId;!1!==e?(G.auth={sessionId:e,username:Z.cachedName},G.connect()):this.createPlayer(),G.once("player:created",(({player:e})=>{this.player=e})),G.on("player:updated",(({player:e})=>{this.player=e})),G.on("player:connected",(({player:e})=>{X.show({title:c.notification.playerJoined.title,message:c.notification.playerJoined.message(e.username),autoHide:!0})}))}static setPlayerNameDom({player:o}){const l=e("playerName");l&&(l.innerText=o.username)}createPlayer(){const e=prompt(c.notification.playerName);this.player={username:e},this.connectPlayer(this.player)}connectPlayer(e){G.auth=e,G.connect()}delete(){return N.removeItem("player")}set player(e){if(!e.username)throw new Error("Invalid player object. No username.");this.#cachedPlayer=e,N.setItem("player",e.username),Z.setPlayerNameDom(e.username)}get player(){return this.#cachedPlayer}static get cachedName(){return N.getItem("player")}get name(){return this.#cachedPlayer.username}get id(){return this.#cachedPlayer?.id||o(6).toLowerCase()}}class ee{currentView;previousView=[];silent=!1;constructor(){this.currentView=document.querySelectorAll(".applicationWindow:not(.hidden)")[0],P(T,(()=>{const o=this.previousView.pop();e(o)&&this.navigate({page:o,silent:true})})),P(L,(o=>{const{page:l}=o.detail;e(l)&&this.navigate({page:l})}))}hideCurrent(){this.currentView&&(this.silent||(this.previousView=this.currentView),I(S,{page:this.currentView}),this.currentView.classList.add("hidden"))}navigate({page:o,silent:l}){this.silent=l||!1,this.currentView?.id!==o&&(this.hideCurrent(),this.currentView=e(o),this.currentView.classList.remove("hidden"),I(k,{page:this.currentView}),this.silent=!1)}static navigateTo(e){I(L,{page:e})}static back(){I(T)}}class oe{static COLORS=["green","yellow","blue","red","orange"];static TOTAL_JOKERS=8;initialized=!1;Lobby;Level;Score;Player;#cachedState=!1;constructor(){this.Player=new Z,G.on("game:start",(()=>{I(n)})),G.on("connect",(()=>{this.initialize()})),P(i,(()=>{this.state=this.createState()})),P(s,(()=>{this.new()})),P(n,(()=>{this.continue()})),P(A,(e=>{const{gridBlock:o}=e.detail;this.updateBlockState({gridBlock:o})})),P(p,(e=>{const{joker:o}=e.detail;this.updateJokerState({joker:o})}))}initialize(){x.joinOrCreate(x.cachedLobbyCode).then((e=>{this.Lobby=e,this.Level=new W({Lobby:e,Game:this}),this.Score=new Y({Game:this}),this.start(),this.initialized=!0})).catch((e=>{console.error("Failed to create lobby",e),this.initialized=!1}))}start(){this.state?this.continue():ee.navigateTo("levelSelect")}new(){this.resetState(),this.start()}continue(){ee.navigateTo("gameView"),I(y)}resetState(){this.Level.reset(),this.state=!1}createState(){let e,o={grid:this.Level.getGrid(),jokers:[],colorScores:{}};for(e=0;e<oe.TOTAL_JOKERS;e++)o.jokers.push({selected:!1});return o}get state(){return this.#cachedState||(this.#cachedState=N.getItem("state",!1)),this.#cachedState}set state(e){this.#cachedState=e,e?N.setItem("state",e):N.removeItem("state")}updateState(e,o,l,t,r="grid"){let a=this.state,c=!1;a.grid.forEach(((s,n)=>{s.column===e&&(a.grid[n][r][o][l]=t,c=!0)})),c&&(this.state=a,I(y))}updateBlockState({gridBlock:e}){let o=this.state,l=!1;o.grid.forEach(((t,r)=>{t.column===e.letter&&(o.grid[r].grid[e.row].selected=e.selected,l=!0)})),l&&(this.state=o)}updateJokerState({joker:e}){let o=this.state,l=!1;o.jokers.forEach(((o,t)=>{t===e.row&&(o.selected=e.selected,l=!0)})),l&&(this.state=o)}updateColorScoreState(e,o,l){let t=!1,r=this.state;r.colorScores[e].forEach((e=>{e.color===o&&(e.value=l,t=!0)})),t&&(this.state=r,I(y))}}class le{currentGame=!1;router;version;constructor(){e("app").innerHTML+=J.render(),this.router=new ee,P(m,(o=>{const{modalId:l}=o.detail;e(l)&&e(l).classList.toggle("show")})),P(g,(o=>{const{modalId:l}=o.detail,t=e(l);t&&t.classList.contains("show")&&t.classList.remove("show"),t.dataset.selfdestruct&&t.remove()})),P(v,(o=>{const{modalId:l}=o.detail;e(l)&&!e(l).classList.contains("show")&&e(l).classList.add("show")})),this.currentGame=new oe,this.parseOrientationOverlay(),this.parseGenericLoading(),e("connecting-message").innerText=c.messages.connecting,P(w,(()=>{I(v,{modalId:"genericLoading"})})),P(y,(()=>{this.render()})),G.on("version",(e=>{N.setItem("version",e)})),G.on("session",(({sessionId:e})=>{Q.cachedId=e})),G.on("connect",(()=>{document.body.classList.add("connected")})),G.on("disconnect",(()=>{document.body.classList.remove("connected"),x.setPlayers([])})),e("newGameButton").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();(class{static newGame({modalId:e}){return e||(e=`modal_${o(8)}`),j({id:e,visible:!0,selfDestruct:!0,message:c.modal.newGame.body,buttons:{cancel:{id:e+"Cancel",label:c.label.cancel,callback(o){o.preventDefault(),o.stopPropagation(),I(g,{modalId:e})}},ok:{id:e+"Confirm",label:c.label.ok,callback(o){o.preventDefault(),o.stopPropagation(),I(g,{modalId:e}),I(s)}}}})}static claimColumn({modalId:e,message:l,data:t}){return e||(e=`modal_${o(8)}`),j({id:e,visible:!0,selfDestruct:!0,message:l,buttons:{cancel:{id:e+"Cancel",label:"Dont claim",callback(o){o.preventDefault(),o.stopPropagation(),I(f,{player:t.player,column:t.columnLetter}),I(g,{modalId:e})}},ok:{id:e+"Confirm",label:"Claim",callback(o){o.preventDefault(),o.stopPropagation(),I(g,{modalId:e}),I(f,{player:t.player,column:t.columnLetter})}}}})}}).newGame({modalId:"newGameModal"}),I(v,{modalId:"newGameModal"})}),!1)}parseOrientationOverlay(){j({id:"orientationModal",message:c.notification.landscapeMode})}parseGenericLoading(){j({visible:!1,id:"genericLoading",message:"Aan het laden.. een moment geduld."})}parseColumnGrid(e){J.renderGrid({columns:e.grid})}parseJokerColumn(e){J.renderJokers({jokers:e.jokers})}parseScoreColumns(o){e("scoreColumn1").innerHTML=o.colorScores.high.map((e=>`<span class="score-block final-score ${e.color}" data-color="${e.color}" data-type="colorScore" data-value="5"><span>5</span></span>`)).join(""),e("scoreColumn2").innerHTML=o.colorScores.low.map((e=>`<span class="score-block final-score ${e.color}" data-color="${e.color}" data-type="colorScore" data-value="3"><span>3</span></span>`)).join("");let l=function(e,o=5,l=-1){return e.classList.contains("final-selected")||e.classList.contains("selected")?e.classList.contains("final-selected")&&!e.classList.contains("selected")?l:0:o},t=function(e){let o="";return oe.COLORS.forEach((l=>{e.classList.contains(l)&&(o=l)})),o},r=document.querySelectorAll("#scoreColumn1 .final-score");Array.prototype.forEach.call(r,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation(),this.currentGame.updateColorScoreState("high",t(e),l(e,5,-1)),I(d)}),!1)}));let a=document.querySelectorAll("#scoreColumn2 .final-score");Array.prototype.forEach.call(a,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation(),this.currentGame.updateColorScoreState("low",t(e),l(e,3,-1)),I(d)}),!1)}))}parseGrid(){const{state:e}=this.currentGame;this.parseColumnGrid(e),this.parseJokerColumn(this.currentGame.state),this.parseScoreColumns(this.currentGame.state),I(h)}parseTotalScores(){if(e("totalScores"))return;const o=`\n            <div id="totalScores">\n                <div class="totals" id="bonus"><label class="rainbow">${c.label.bonus}</label><span class="label">=</span><span id="bonusTotal" class="totalValue">15</span></div>\n                <div class="totals" id="columns"><label>${c.label.columns}</label><span class="label">+</span><span id="columnsTotal" class="totalValue"></span></div>\n                <div class="totals" id="jokers"><label>${c.label.jokers}</label><span class="label">+</span><span id="jokerTotal" class="totalValue"></span></div>\n                <div class="totals" id="stars"><label>${c.label.stars}</label><span class="label">-</span><span id="starsTotal" class="totalValue"></span></div>\n                <div class="totals" id="totals">\n                    <label>${c.label.totals}</label><span class="label">&nbsp;</span><span id="totalScore" class="totalValue hide"></span>\n                </div>\n            </div>\n        `;e("scoreColumn").innerHTML+=o,e("totals").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),I(u)}),!1)}renderNewGameButton(o){const l="newGameButton";if(e(l))return;const t=function(e={}){const o={callback:()=>!1,className:"button",...e};let l=r(`<a>${o.label}</a>`);return o.callback&&"function"==typeof o.callback&&l.addEventListener("click",o.callback,!1),o.className&&(l.className=o.className),o.id&&(l.id=o.id),l}({callback:o,id:l,label:c.label.newGame,className:"new-game"});return e("gameView").append(t),t}render(){this.parseGrid(),this.parseTotalScores(),I(d)}parseColumn(e){}}try{window.engine=new le}catch(e){console.error("Failed to load game. Reset state!",e)}window.Block=M;
