function e(e){return document.getElementById(e)}function o(e=6){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,e)}function t(e,o){Array.prototype.forEach.call(document.querySelectorAll(e),o)}function l(e){const o=document.createElement("div");return o.innerHTML=e,o.firstElementChild}var r={modal:{newGame:{body:"Weet je zeker dat je een nieuw spel wil beginnen?"}},label:{cancel:"Annuleren",ok:"OK",newGame:"Nieuw spel",bonus:"bonus",columns:"A-O",stars:"Sterren",totals:"Totaal",jokers:"Jokers",startGame:"Start Spel"},messages:{connecting:"Bezig met verbinden ..."},notification:{landscapeMode:"Draai het scherm horizontaal om te beginnen.",selectLevel:"Selecteer een level.",playerName:"Wat is je naam?",createLobby:"Kies een spelcode:",creatingLobby:"Bezig met het aanmaken van de lobby...",playerJoined:{title:"Een speler is verbonden",message:(e="onbekend")=>`${e} speelt mee!`}}};document.querySelector("body").classList.add("lang-nl");const a=r,c="game-new",s="game-start",n="game-create-state",i="score-reload",d="score-total-toggle",u="modal-hide",g="modal-show",m="joker-selected",v="star-selected",h="render-level",p="navigate",b="navigate-back",y="score-column-update",w="score-color-update",S="update-grid-block",T=e("app");function E(e,o){let t=new CustomEvent(e,{detail:o});T.dispatchEvent(t)}function k(e,o,t=!1){T.addEventListener(e,o,!1)}const L=(0,window.io)("https://dry-peak-80209.herokuapp.com/",{autoConnect:!1});L.onAny(((e,...o)=>{}));class C{static newGame({modalId:e="newGameModal",message:t,emit:l=!1}={}){return e||(e=`modal_${o(8)}`),f({id:e,visible:!0,selfDestruct:!0,message:t||a.modal.newGame.body,buttons:{cancel:{id:e+"Cancel",label:a.label.cancel,callback(o){o.preventDefault(),o.stopPropagation(),E(u,{modalId:e})}},ok:{id:e+"Confirm",label:a.label.ok,callback(o){o.preventDefault(),o.stopPropagation(),E(u,{modalId:e}),E(c),l&&L.emit("game:new")}}}})}static showNewGameModal({modalId:e="newGameModal",message:o,emit:t=!1}={}){C.newGame({modalId:e,message:o,emit:t}),E(g,{modalId:e})}}function f(t){let r={...{id:"modal-"+o(),message:"No modal message is set.",buttons:!1,appendTo:"#app",visible:!1},...t};!0===r.buttons&&(r.buttons={cancel:{id:r.id+"-cancel",label:a.label.cancel},ok:{id:r.id+"-ok",label:a.label.ok}});let c=l(`\n        <div class="modal-overlay${r.visible?" show":""}" id="${r.id}"${r.selfDestruct?' data-selfDestruct="true"':""}>\n            <div class="modal-container">\n                ${r.title?`\n                <div class="modal-title">\n                    <h2>${r.title}</h2>\n                </div>\n                `:""}\n                ${r.body&&!r.message?r.body:`\n                <div class="modal-body">\n                    <p>${r.message}</p>\n                </div>\n                `}\n                ${r.buttons?`\n                <div class="modal-button-bar">\n                    ${r.buttons.cancel?`<a href="#" id="${r.buttons.cancel.id}" class="button button-cancel">${r.buttons.cancel.label}</a>`:""}\n                    ${r.buttons.ok?`<a href="#" id="${r.buttons.ok.id}" class="button button-confirm">${r.buttons.ok.label}</a>`:""}\n                </div>\n                `:""}\n            </div>\n        </div>\n    `);return r.buttons.cancel&&"function"==typeof r.buttons.cancel.callback&&c.querySelector("#"+r.buttons.cancel.id).addEventListener("click",r.buttons.cancel.callback,!1),r.buttons.ok&&"function"==typeof r.buttons.ok.callback&&c.querySelector("#"+r.buttons.ok.id).addEventListener("click",r.buttons.ok.callback,!1),e("app").append(c),c}class A{static prefix="kok_";static removeItem(e){return localStorage.removeItem(A.prefix+e)}static setItem(e,o=""){return localStorage.setItem(A.prefix+e,JSON.stringify(o))}static getItem(e,o=!1){let t=localStorage.getItem(A.prefix+e);return null===t?o:JSON.parse(t)}}const $=new WeakMap;function I(e,o,t,l){var r,a;if(!e&&!$.has(o))return!1;const c=null!==(r=$.get(o))&&void 0!==r?r:new WeakMap;if($.set(o,c),!e&&!$.has(o))return!1;const s=null!==(a=c.get(t))&&void 0!==a?a:new Set;c.set(t,s);const n=s.has(l);return e?s.add(l):s.delete(l),n&&e}function P(e,o,t,l,r){if("string"==typeof e&&(e=document.querySelectorAll(e)),"function"!=typeof e.addEventListener){const a=Array.prototype.map.call(e,(e=>P(e,o,t,l,r)));return{destroy(){for(const e of a)e.destroy()}}}const a=e instanceof Document?e.documentElement:e,c=Boolean("object"==typeof r?r.capture:r),s=e=>{const t=function(e,o){let t=e.target;if(t instanceof Text&&(t=t.parentElement),t instanceof Element&&e.currentTarget instanceof Element){const l=t.closest(o);if(l&&e.currentTarget.contains(l))return l}}(e,o);t&&(e.delegateTarget=t,l.call(a,e))},n=JSON.stringify({selector:o,type:t,capture:c}),i={destroy(){a.removeEventListener(t,s,r),I(!1,a,l,n)}};return I(!0,a,l,n)||a.addEventListener(t,s,r),i}class O{template=!1;state={};constructor({letter:e,row:o,color:t,selected:l=!1,element:r}){this.template=r,this.letter=e,this.row=o,this.color=t,this.selected=l}get letter(){return this.state?.letter}get row(){return this.state?.row}get color(){return this.state?.color}get selected(){return!!this.state?.selected}set letter(e){this.state.letter=e}set row(e){this.state.row=parseInt(e)}set color(e){this.state.color=e}set selected(e){e!==this.state.selected&&(this.state.selected=!!e,this.onSelected())}get selectedClass(){return"selected"}onSelected(){this.element&&this.selected&&this.element.classList.add(this.selectedClass),this.element&&!this.selected&&this.element.classList.remove(this.selectedClass)}set element(e){"string"==typeof e&&(e=l(e)),this.template=e}get element(){return this.template}render(){const e=`\n            <span \n                class="score-block${this.selected?" selected":""}" \n                data-letter="${this.letter}" \n                data-row="${this.row}" \n                data-color="${this.color}">\n            </span>\n        `;return this.element=e,e}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const o=e.classList.contains("selected"),{letter:t,row:l,color:r}=e.dataset;return new O({letter:t,row:l,color:r,selected:o})}static getByProperties({letter:e,row:o}){return document.querySelector(`[data-letter="${e}"][data-row="${o}"]`)}}class j extends O{constructor({letter:e,row:o,color:t,star:l=!1,selected:r=!1,element:a}){super({letter:e,row:o,color:t,selected:r,element:a}),this.state.star=l}render(){const e=`\n            <span \n                class="score-block${this.selected?" selected":""}"\n                data-type="score-block" \n                data-letter="${this.letter}" \n                data-row="${this.row}" \n                data-color="${this.color}">\n                ${this.star?'<span class="star">*</span>':""}    \n            </span>\n        `;return this.element=e,P("#app",`[data-type="score-block"][data-letter="${this.letter}"][data-row="${this.row}"]`,"click",(e=>{this.refresh(),this.onClick({event:e})})),e}refresh(){this.element=document.querySelector(`[data-type="score-block"][data-letter="${this.letter}"][data-row="${this.row}"]`)}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.selected=!this.selected,E(S,{gridBlock:this}),_.setColumnScoreState({letter:this.letter,shouldEmit:!0}),_.setColorScoreState({color:this.color,shouldEmit:!0}),E(y),E(w)}get star(){return this.state?.star}set star(e){this.state.star=!!e}onSelected(){super.onSelected(),this.star&&E(v,{selected:this.selected,block:this})}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const o=!!e.querySelector("span.star"),t=e.classList.contains("selected"),{letter:l,row:r,color:a}=e.dataset;return new j({letter:l,row:r,color:a,star:o,selected:t,element:e})}}class G extends O{static TYPE_COLUMN_SCORE="column-score";static TYPE_COLOR_SCORE="color-score";static TYPE_JOKER="joker";#DEFAULT_VALUE=0;constructor({letter:e,row:o,color:t,selected:l=!1,element:r,value:a=0,type:c}){super({letter:e,row:o,color:t,selected:l,element:r}),this.type=c,this.value=a}set value(e){isNaN(e)&&(e=this.#DEFAULT_VALUE),this.state.value=e}get value(){return this.state?.value||this.#DEFAULT_VALUE}set type(e){this.state.type=e}get type(){return this.state?.type}}class N extends G{static STATE={DEFAULT:"default",ACTIVE:"active",TAKEN:"taken"};cache;constructor({state:e=N.STATE.DEFAULT,letter:o,row:t=-1,color:l="white",selected:r=!1,element:a,value:c=0,type:s=G.TYPE_COLUMN_SCORE}){if(super({letter:o,row:t,color:l,selected:r,element:a,value:c,type:s}),!o||-1===t)throw new Error("Need letter and row for new block instance.");let n=this.storage[o+t];e=n!==N.STATE.DEFAULT?n:e,this.blockState=e}get blockStateKey(){return this.letter+this.row}set storage(e){A.setItem("columnScore",e),this.cache=e}get storage(){return this.cache?this.cache:A.getItem("columnScore",{})}static clearStorage(){A.removeItem("columnScore")}set blockState(e){e=-1===Object.values(N.STATE).indexOf(e)?N.STATE.DEFAULT:e,this.state.blockState=e,this.element&&(Object.values(N.STATE).forEach((e=>this.element.classList.remove(e))),this.element.classList.add(e));let o=this.storage;o[this.blockStateKey]=e,this.storage=o}get blockState(){return this.state?.blockState}render(){const e=`\n            <span \n                class="rounded-block column-score" \n                data-letter="${this.letter}" \n                data-row="${this.row}"\n                data-type="${this.type}">\n                    ${this.value}\n            </span>\n        `;return this.element=e,P("#app",`[data-type="${this.type}"][data-letter="${this.letter}"][data-row="${this.row}"]`,"click",(e=>{this.onClick({event:e})})),e}toggleState(){switch(this.blockState){case N.STATE.DEFAULT:this.active();break;case N.STATE.ACTIVE:this.row>0?this.default():this.taken();break;case N.STATE.TAKEN:this.default()}}isHighScore(){return 0===this.row}isTaken(){return this.blockState===N.STATE.TAKEN}isActive(){return this.blockState===N.STATE.ACTIVE}taken(){this.blockState=N.STATE.TAKEN}active(){this.blockState=N.STATE.ACTIVE}default(){this.blockState=N.STATE.DEFAULT}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.refresh(),this.toggleState()}refresh(){this.element=N.getElementByProperties({letter:this.letter,row:this.row}),this.state.blockState=N.getStateFromClassList(this.element)}static getStateFromClassList(e){return e.classList.contains("active")?N.STATE.ACTIVE:e.classList.contains("taken")?N.STATE.TAKEN:N.STATE.DEFAULT}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const{letter:o,row:t,color:l}=e.dataset;return new N({letter:o,row:t,color:l,element:e})}static getElementByProperties({letter:e,row:o=0}){return document.querySelector(`[data-type="${G.TYPE_COLUMN_SCORE}"][data-letter="${e}"][data-row="${o}"]`)}static getFirstAvailable({letter:e}){const o=document.querySelector(`[data-type="${G.TYPE_COLUMN_SCORE}"][data-letter="${e}"]:not(.${N.STATE.ACTIVE}):not(.${N.STATE.TAKEN})`);return!!o&&N.getInstance(o)}static getAll({letter:e}){return[...document.querySelectorAll(`[data-type="${G.TYPE_COLUMN_SCORE}"][data-letter="${e}"]`)].map((e=>N.getInstance(e)))}}class D extends N{constructor({state:e=N.STATE.DEFAULT,color:o="white",element:t,value:l=0}){if(super({letter:o,row:parseInt(l),color:o,selected:!1,element:t,value:parseInt(l),type:G.TYPE_COLOR_SCORE,state:e}),!o||l<0)throw new Error("Need color and value for new ColorScoreBlock instance.")}render(){const e=`<span class="score-block final-score${this.blockState!==N.STATE.DEFAULT?" "+this.blockState:""}" data-color="${this.color}" data-type="${this.type}" data-value="${this.value}"><span>${this.value}</span></span>`;return this.element=e,P("#app",`[data-type="${this.type}"][data-color="${this.color}"][data-value="${this.value}"]`,"click",(e=>{this.onClick({event:e})})),e}refresh(){this.element=D.getElementByProperties({color:this.color,value:this.value}),this.state.blockState=D.getStateFromClassList(this.element)}isHighScore(){return 5===this.value}toggleState(){const e=this.blockState;e!==D.STATE.DEFAULT?e!==D.STATE.ACTIVE?(D.STATE.TAKEN,this.default()):this.taken():this.active()}static getInstance(e){"string"==typeof e&&(e=document.querySelector(e)),e.length>1&&(e=e[0]);const{value:o,color:t}=e.dataset;return new D({color:t,value:o,element:e})}static getElementByProperties({color:e,value:o=0}){return document.querySelector(`[data-type="${G.TYPE_COLOR_SCORE}"][data-color="${e}"][data-value="${o}"]`)}static getAll({color:e,value:o=5}){return[...document.querySelectorAll(`[data-type="${G.TYPE_COLOR_SCORE}"][data-value="${o}"][data-color="${e}"]`)].map((e=>D.getInstance(e)))}static getFirstAvailable({color:e}){const o=document.querySelector(`[data-type="${G.TYPE_COLOR_SCORE}"][data-color="${e}"]:not(.${D.STATE.ACTIVE}):not(.${D.STATE.TAKEN})`);return!!o&&D.getInstance(o)}set storage(e){A.setItem("colorScore",e)}get storage(){return A.getItem("colorScore",{})}static clearStorage(){A.removeItem("colorScore")}}class V extends G{constructor({joker:e,row:o,element:t}){const l=G.TYPE_JOKER;super({letter:"X",row:o,color:"green",selected:e.selected||!1,element:t,value:0,type:l})}render(){const e=`<span class="joker${this.selected?" used":""}" data-type="joker" data-row="${this.row}">!</span>`;return this.element=e,P("#app",`[data-type="joker"][data-row="${this.row}"]`,"click",(e=>{this.refresh(),this.onClick({event:e})})),e}refresh(){this.element=document.querySelector(`[data-type="joker"][data-row="${this.row}"]`)}get selectedClass(){return"used"}onClick({event:e}){e.preventDefault(),e.stopPropagation(),this.selected=!this.selected,E(m,{joker:this})}}class _{static setColumnScoreState({letter:e,shouldEmit:o=!1}){_.isColumnComplete({letter:e})?_.toggleCompletedColumn({letter:e,shouldEmit:o}):_.clearColumnScore({letter:e,shouldEmit:o})}static toggleCompletedColumn({letter:e,shouldEmit:o=!1}){let t=0===N.getAll({letter:e}).filter((e=>e.isActive())).length,l=N.getFirstAvailable({letter:e});t&&!1!==l&&(l?.active(),l.isHighScore()&&o&&L.emit("grid:column-complete",{letter:e}))}static clearColumnScore({letter:e,shouldEmit:o=!1}){N.getAll({letter:e}).forEach((t=>{t.isActive()&&(t.default(),t.isHighScore()&&o&&L.emit("grid:column-clear",{letter:e}))}))}static isColumnComplete({letter:e}){const o=document.querySelectorAll(`[data-letter="${e}"]`)[0]?.parentElement;return 7===o.querySelectorAll(".score-block.selected").length}static setColorScoreState({color:e,shouldEmit:o=!1}){_.isColorComplete({color:e})?_.toggleCompletedColor({color:e,shouldEmit:o}):_.clearColorScore({color:e,shouldEmit:o})}static isColorComplete({color:e}){const o=document.querySelectorAll(`[data-color="${e}"][data-type="score-block"]`),t=document.querySelectorAll(`[data-color="${e}"][data-type="score-block"].selected`);return o.length===t.length}static toggleCompletedColor({color:e,shouldEmit:o=!1}){let t=0===D.getAll({color:e}).filter((e=>e.isActive())).length,l=D.getFirstAvailable({color:e});t&&!1!==l&&(l?.active(),l.isHighScore()&&o&&L.emit("grid:color-complete",{color:e}))}static clearColorScore({color:e,shouldEmit:o=!1}){D.getAll({color:e}).forEach((t=>{t.isActive()&&(t.default(),t.isHighScore()&&o&&L.emit("grid:color-clear",{color:e}))}))}}class M{static render(){return`\n            ${M.renderViewGame()}\n            ${M.renderViewLevelSelect()}\n        `}static applicationWindow(e,o){return`\n            <div id="${e}" class="applicationWindow hidden">${o}</div>\n        `}static renderViewGame(){return M.applicationWindow("gameView",'\n            <div class="gameViewRows">\n                <div class="columns">\n                    <div class="jokers" id="jokerContainer"></div>\n                    <div id="blockGrid"></div>\n                    <div class="scoreContainer">\n                        <div class="column" id="scoreColumn">\n                            <div id="scoreColumn1"></div>\n                        </div>\n                        <div class="column" id="scoreColumn2"></div>\n                    </div>\n                </div>\n                <div id="gameData">\n                    <div>\n                        <h2 class="rainbow">Spelers</h2>\n                        <ul id="activePlayers" class="blockList playerList"></ul>\n                    </div>\n                    <a id="newGameButton">Nieuw spel</a>\n                </div>\n            </div>\n       ')}static renderViewChangeLobby(){return M.applicationWindow("changeLobby",'\n            <div class="gameViewRows">\n                <div class="columns">\n                    <div class="jokers" id="jokerContainer"></div>\n                    <div id="blockGrid"></div>\n                    <div class="scoreContainer">\n                        <div class="column" id="scoreColumn">\n                            <div id="scoreColumn1"></div>\n                        </div>\n                        <div class="column" id="scoreColumn2"></div>\n                    </div>\n                </div>\n                <div id="gameData">\n                    <ul id="activePlayers" class="blockList playerList"></ul>\n                    <a id="newGameButton">Nieuw spel</a>\n                </div>\n            </div>\n       ')}static renderViewLevelSelect(){return M.applicationWindow("levelSelect",'\n            <div id="playerContainer">\n                <h2 class="rainbow">Spelers</h2>\n                <ul id="players" class="blockList playerList"></ul>\n                <h2 class="rainbow">Lobby</h2>\n                <a href="#" id="lobbyCode">Cool</a>\n            </div>\n            <div id="levelContainer">\n                <h2 class="rainbow">Selecteer een level</h2>\n                <ul id="levels" class="blockList">\n                    <li class="level">\n                        <a href="#" class="level1" data-level="level1">\n                            <img src="/images/level1.png" alt="level1" />\n                            <span class="label">Level 1</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level2" data-level="level2">\n                            <img src="/images/level2.png" alt="level2" />\n                            <span class="label">Level 2</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level3" data-level="level3">\n                            <img src="/images/level3.png" alt="level3" />\n                            <span class="label">Level 3</span>\n                        </a>\n                    </li>\n                    <li class="level">\n                        <a href="#" class="level4" data-level="level4">\n                            <img src="/images/level4.png" alt="level4" />\n                            <span class="label">Level 4</span>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        ')}static renderPlayer({player:e}){return`<li class="player" data-player="${e.username}" data-player-id="${e.userId}">${e.username}</li>`}static renderPlayerAvatar({url:e,playerName:o}){return`<img src="${e}" alt="${o}"/><span>${o}</span>`}static renderJokers({jokers:o}){e("jokerContainer").innerHTML=o.map(((e,o)=>new V({joker:e,row:o}).render())).join("")}static renderGrid({columns:o}){const t=e("blockGrid");t.innerHTML="",o.forEach((e=>{t.append(M.renderGridColumn({column:e})),_.setColumnScoreState({letter:e.column,shouldEmit:!1})}))}static renderGridColumn({column:e}){const o=e.column;return l(`\n            <div class="column${"H"===e.column?" highlight":""}">\n                <span class="rounded-block header" data-letter="${o}">${o}</span>\n                ${M.renderGridColumnBlocks({blocks:e.grid,column:e})}\n                ${M.renderColumnScores({column:e})}\n            </div>\n        `)}static renderGridColumnBlocks({blocks:e,column:o}){return e.map(((e,t)=>new j({letter:o.column,row:t,color:e.color,star:e.star,selected:e.selected}).render())).join("")}static renderColumnScores({column:e}){return`<div class="column-score">${e.score.map(((o,t)=>{const{value:l,state:r}=o,a=e.column;return new N({letter:a,row:t,value:l,state:r}).render()})).join("")}</div>`}}class q{#lobby=!1;state=!1;constructor(e){this.lobby=e,L.on("player:stats",(({player:e})=>{q.setLobbyCodeDom({code:e.lobbyCode})})),L.on("lobby:updated",(({lobby:e})=>{this.lobby=e})),L.once("lobby:joined",(({lobby:e})=>{this.lobby=e})),L.once("lobby:created",(({lobby:e})=>{this.lobby=e})),L.on("player:connected",(({player:e})=>{q.addPlayerToLobby(e)})),L.on("player:disconnected",(({player:e})=>{q.removePlayerFromLobby(e)}))}static loadAvatars(){t("#players .player:not(.avatar), #activePlayers .player:not(.avatar)",(e=>{const o=e.innerText,t=new URL(`https://avatars.dicebear.com/api/bottts/${o}.svg?mood[]=happy`);e.innerHTML=M.renderPlayerAvatar({url:t,playerName:o}),e.classList.add("avatar")}))}static getPlayerElement(e){return document.querySelectorAll(`[data-player-id="${e.userId}"]`)[0]}static addPlayerToLobby(e){q.getPlayerElement(e)||(t("#players, #activePlayers",(o=>{o.innerHTML+=M.renderPlayer({player:e})})),q.loadAvatars())}static removePlayerFromLobby(e){t("#players, #activePlayers",(o=>{const t=q.getPlayerElement(e);t&&t.remove()}))}static setPlayers(e){t("#players, #activePlayers",(e=>{e.innerHTML=""})),e.length>0&&e.forEach((e=>{q.addPlayerToLobby(e)}))}static async joinOrCreate(e){if(e)L.emit("lobby:join",{lobbyCode:e});else{let e=prompt(a.notification.createLobby,o(4).toUpperCase());e=e.toUpperCase(),L.emit("lobby:create",{lobbyCode:e})}return new Promise(((e,o)=>{L.once("lobby:joined",(({lobby:o})=>{e(new q(o))})),L.once("lobby:created",(({lobby:o})=>{e(new q(o))})),setTimeout((()=>{o("Lobby creation timeout.")}),1e4)}))}static setLobbyCodeDom({code:o}){const t=e("lobbyCode");t&&(t.innerText=o)}static setState(e){L.emit("lobby:state",{key:"state",value:e})}leave(){L.emit("lobby:leave",{lobbyCode:this.code})}get players(){return this.lobby?.players||[]}get code(){return this.lobby?.code}static get cachedLobbyCode(){return A.getItem("lobby",!1)}get state(){return this.lobby?.state}set lobby(e){e.code!==this.#lobby.code&&A.setItem("lobby",e.code),q.setLobbyCodeDom({code:e.code}),e.players.length>0&&q.setPlayers(e.players),this.#lobby=e}get lobby(){return this.#lobby}get playerNames(){return this.players.map((e=>e.username)).join(", ")}}const R=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"yellow"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"green"},{color:"red"},{color:"orange"},{color:"blue",star:!0},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow",star:!0},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"green"},{color:"orange"},{color:"red",star:!0},{color:"blue"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"green"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"orange"},{color:"green",star:!0},{color:"blue"},{color:"blue"},{color:"red"},{color:"red"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green",star:!0},{color:"orange"},{color:"red"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"red"},{color:"green"},{color:"orange"},{color:"yellow",star:!0},{color:"yellow"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"green"},{color:"orange"},{color:"orange"},{color:"yellow"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"red",star:!0},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"blue"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"red"},{color:"blue"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"red",star:!0},{color:"red"},{color:"blue"},{color:"orange"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"green"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]}],B=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"},{color:"green",star:!0}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"orange"},{color:"blue"},{color:"yellow"},{color:"yellow"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"yellow"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"red"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"red"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"green"},{color:"green",star:!0}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"green"},{color:"blue"},{color:"yellow"},{color:"orange",star:!0}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"green"},{color:"yellow",star:!0},{color:"blue"},{color:"orange"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"red",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green"},{color:"blue"},{color:"blue"},{color:"red",star:!0},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"orange",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"yellow"}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"blue"},{color:"blue"},{color:"blue",star:!0},{color:"red"},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"yellow",star:!0},{color:"blue"},{color:"red"},{color:"red"},{color:"orange"},{color:"orange"},{color:"green"}]}],F=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"yellow"},{color:"orange"},{color:"orange"},{color:"orange"},{color:"green"},{color:"blue",star:!0},{color:"red"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"yellow"},{color:"blue"},{color:"orange"},{color:"green",star:!0},{color:"green"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"green"},{color:"red"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"blue"},{color:"blue"},{color:"yellow"},{color:"red",star:!0},{color:"green"},{color:"green"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"red"},{color:"yellow",star:!0},{color:"yellow"},{color:"yellow"},{color:"green"},{color:"blue"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"green",star:!0},{color:"red"},{color:"red"},{color:"yellow"},{color:"orange"},{color:"orange"},{color:"blue"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"blue"},{color:"red",star:!0},{color:"orange"},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"blue"},{color:"red"},{color:"orange"},{color:"orange"},{color:"yellow",star:!0},{color:"green"},{color:"green"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow"},{color:"blue",star:!0},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"yellow"},{color:"yellow",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"red"},{color:"green"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"blue"},{color:"blue"},{color:"orange",star:!0},{color:"orange"},{color:"yellow"},{color:"green"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"green",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"red",star:!0},{color:"blue"},{color:"blue"},{color:"orange"},{color:"yellow"},{color:"yellow"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"orange"},{color:"blue",star:!0},{color:"red"},{color:"red"},{color:"red"},{color:"yellow"}]}],H=[{column:"A",score:[{value:5},{value:3}],grid:[{color:"orange",star:!0},{color:"blue"},{color:"yellow"},{color:"yellow"},{color:"red"},{color:"green"},{color:"green"}]},{column:"B",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"blue"},{color:"yellow",star:!0},{color:"yellow"},{color:"green"},{color:"red"}]},{column:"C",score:[{value:3},{value:2}],grid:[{color:"yellow",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"green"},{color:"green"},{color:"red"}]},{column:"D",score:[{value:3},{value:2}],grid:[{color:"orange"},{color:"orange"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"red"},{color:"red"}]},{column:"E",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"green",star:!0},{color:"green"},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"orange"}]},{column:"F",score:[{value:2},{value:1}],grid:[{color:"red"},{color:"red"},{color:"red"},{color:"yellow"},{color:"green",star:!0},{color:"blue"},{color:"orange"}]},{column:"G",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"green"},{color:"green"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"orange"}]},{column:"H",score:[{value:1},{value:0}],grid:[{color:"green"},{color:"green"},{color:"yellow"},{color:"blue",star:!0},{color:"orange"},{color:"orange"},{color:"red"}]},{column:"I",score:[{value:2},{value:1}],grid:[{color:"orange"},{color:"yellow",star:!0},{color:"yellow"},{color:"blue"},{color:"blue"},{color:"green"},{color:"red"}]},{column:"J",score:[{value:2},{value:1}],grid:[{color:"red",star:!0},{color:"red"},{color:"yellow"},{color:"yellow"},{color:"blue"},{color:"green"},{color:"orange"}]},{column:"K",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"red"},{color:"red"},{color:"yellow"},{color:"blue"},{color:"orange",star:!0},{color:"orange"}]},{column:"L",score:[{value:2},{value:1}],grid:[{color:"green"},{color:"green",star:!0},{color:"red"},{color:"red"},{color:"blue"},{color:"yellow"},{color:"orange"}]},{column:"M",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"blue"},{color:"blue"},{color:"orange"},{color:"orange"},{color:"yellow"},{color:"red",star:!0}]},{column:"N",score:[{value:3},{value:2}],grid:[{color:"green"},{color:"yellow"},{color:"yellow"},{color:"orange"},{color:"blue"},{color:"blue",star:!0},{color:"red"}]},{column:"O",score:[{value:5},{value:3}],grid:[{color:"green"},{color:"yellow"},{color:"orange",star:!0},{color:"orange"},{color:"blue"},{color:"blue"},{color:"red"}]}];class U{selectedLevel=!1;static levelMap={level1:R,level2:B,level3:F,level4:H};constructor(){L.on("level:selected",(({selectedLevel:e})=>{this.level=e})),this.registerEventHandlers()}static selectInDom(e){const o=document.querySelectorAll("#levels .level a."+e)[0];t("#levels .level a",(e=>{e.classList.remove("selected"),document.getElementById("startGame")?.remove()})),o&&(o.classList.toggle("selected"),o.innerHTML+=`<span id="startGame">${a.label.startGame} &rarr;</span>`)}registerEventHandlers(){const e=document.querySelectorAll("li.level > a");Array.prototype.forEach.call(e,(e=>{e.addEventListener("click",(o=>{o.preventDefault(),o.stopPropagation();const t=e.dataset.level;e.classList.contains("selected")?L.emit("game:start"):(this.level=t,L.emit("level:select",{selectedLevel:t}))}),!1)}))}reset(){this.level=!1}getGrid(){return U.levelMap[this.level]}set level(e){if(!1===e)return A.removeItem("level"),void(this.selectedLevel=e);e!==this.selectedLevel&&(this.selectedLevel=e,E(n),U.selectInDom(e)),A.setItem("level",this.selectedLevel)}get level(){let e=this.selectedLevel;return e||(e=A.getItem("level")),e}}class J{static JOKER_VALUE=1;static STAR_VALUE=-2;Game;constructor({Game:e}){this.Game=e,e.initialized||(k(m,(()=>{this.renderScores({scores:{jokers:this.jokerScore}})})),k(v,(()=>{this.renderScores({scores:{stars:this.starScore}})})),k(i,(()=>{this.renderScores({scores:{bonus:this.bonusScore,columns:this.columnScore,jokers:this.jokerScore,stars:this.starScore,total:this.total}})})),k(d,(()=>this.toggleTotalScore())),k(y,(()=>{this.renderColumnScore(this.columnScore)})),k(w,(()=>{this.renderBonusScore(this.bonusScore)}))),L.on("grid:column-completed",(({letter:e})=>{N.getAll({letter:e}).filter((e=>e.isHighScore()&&!e.active())).forEach((e=>e.taken()))})),L.on("grid:column-cleared",(({letter:e})=>{N.getAll({letter:e}).filter((e=>e.isTaken())).forEach((e=>e.default()))})),L.on("grid:color-completed",(({color:e})=>{D.getAll({color:e}).filter((e=>e.isHighScore()&&!e.active())).forEach((e=>e.taken()))})),L.on("grid:color-cleared",(({color:e})=>{D.getAll({color:e}).filter((e=>e.isTaken())).forEach((e=>e.default()))}))}renderScores({scores:e}){void 0!==e.bonus&&this.renderBonusScore(e.bonus),void 0!==e.columns&&this.renderColumnScore(e.columns),void 0!==e.jokers&&this.renderJokerScore(e.jokers),void 0!==e.stars&&this.renderStarScore(e.stars)}get total(){return this.bonusScore+this.columnScore+this.jokerScore+this.starScore}get columnScore(){let e=document.querySelectorAll("span.column-score.active"),o=0;return Array.prototype.forEach.call(e,(e=>{let t=parseInt(e.innerText);o+=t})),o}get jokerScore(){let e=document.getElementsByClassName("joker"),o=e.length,t=0;return Array.prototype.forEach.call(e,(e=>{e.classList.contains("used")&&t++})),(o-t)*J.JOKER_VALUE}get bonusScore(){let e=document.querySelectorAll(".final-score.active span"),o=0;return Array.prototype.forEach.call(e,(e=>{o+=parseInt(e.innerText)})),o}get starScore(){const e=document.querySelectorAll("span.selected span.star").length;return(document.querySelectorAll("span.star").length-e)*J.STAR_VALUE}toggleTotalScore(){const o=e("totalScore");o.classList.contains("hide")?(o.classList.remove("hide"),this.renderTotalScore()):(o.innerText="",o.classList.add("hide"))}renderBonusScore(o){e("bonusTotal").innerText=o,this.renderTotalScore()}renderColumnScore(o){e("columnsTotal").innerText=o,this.renderTotalScore()}renderJokerScore(o){e("jokerTotal").innerText=o,this.renderTotalScore()}renderStarScore(o){e("starsTotal").innerText=o,this.renderTotalScore()}renderTotalScore(){const o=e("totalScore");o.classList.contains("hide")||(o.innerText=this.total)}}class x{static TRANSITION_DELAY=200;constructor(){}static hide(o){const{id:t,timeout:l=400}=o;e(t)&&(e(t).classList.remove("show"),setTimeout((()=>{const o=e(t);o&&o.remove()}),l))}static removePrevious(){let e=document.querySelectorAll(".notification.show").length;if(e>0){let e=200;t(".notification.show",(o=>{x.hide({id:o.id,timeout:e}),e+=200}))}return e}static show(o){const t=x.removePrevious(),l=o=>{"string"==typeof o&&(o={title:o});let{message:t,title:l="No message specified.",timeout:r=4e3,autoHide:a=!1}=o;const c=x.createTemplate(t,l);e("app").append(c),setTimeout((()=>{e(c.id).classList.toggle("show")}),1),a&&setTimeout((()=>{x.hide({id:c.id})}),r)};t>0?setTimeout((()=>{l(o)}),200*t+200):l(o)}static createTemplate(e,t=!1){return l(`\n            <div class="notification" id="${"notification_"+o(5)}">\n                ${t?`\n                <h2>${t}</h2>\n                `:""}\n                ${e?`\n                <p>${e}</p>\n                `:""}\n            </div>\n        `)}}class K{constructor(){}static get cachedId(){return A.getItem("sessionId")}static set cachedId(e){return A.setItem("sessionId",e)}}class Y{#cachedPlayer=!1;constructor(){const e=K.cachedId;!1!==e?(L.auth={sessionId:e,username:Y.cachedName},L.connect()):this.createPlayer(),L.once("player:created",(({player:e})=>{this.player=e})),L.on("player:updated",(({player:e})=>{this.player=e})),L.on("player:connected",(({player:e})=>{x.show({title:a.notification.playerJoined.title,message:a.notification.playerJoined.message(e.username),autoHide:!0})}))}static setPlayerNameDom({player:o}){const t=e("playerName");t&&(t.innerText=o.username)}createPlayer(){const e=prompt(a.notification.playerName);this.player={username:e},this.connectPlayer(this.player)}connectPlayer(e){L.auth=e,L.connect()}delete(){return A.removeItem("player")}set player(e){if(!e.username)throw new Error("Invalid player object. No username.");this.#cachedPlayer=e,A.setItem("player",e.username),Y.setPlayerNameDom(e.username)}get player(){return this.#cachedPlayer}static get cachedName(){return A.getItem("player")}get name(){return this.#cachedPlayer.username}get id(){return this.#cachedPlayer?.id||o(6).toLowerCase()}}class z{currentView;previousView=[];silent=!1;constructor(){this.currentView=document.querySelectorAll(".applicationWindow:not(.hidden)")[0],k(b,(()=>{const o=this.previousView.pop();e(o)&&this.navigate({page:o,silent:true})})),k(p,(o=>{const{page:t}=o.detail;e(t)&&this.navigate({page:t})}))}hideCurrent(){this.currentView&&(this.silent||(this.previousView=this.currentView),this.currentView.classList.add("hidden"))}navigate({page:o,silent:t}){this.silent=t||!1,this.currentView?.id!==o&&(this.hideCurrent(),this.currentView=e(o),this.currentView.classList.remove("hidden"),this.silent=!1)}static navigateTo(e){E(p,{page:e})}static back(){E(b)}}class W{static COLORS=["green","yellow","blue","red","orange"];static TOTAL_JOKERS=8;initialized=!1;Lobby;Level;Score;Player;#cachedState=!1;constructor(){this.Player=new Y,L.on("game:start",(()=>{E(s)})),L.on("connect",(()=>{this.initialize()})),k(n,(()=>{this.state=this.createState()})),k(c,(()=>{this.new()})),k(s,(()=>{this.continue()})),k(S,(e=>{const{gridBlock:o}=e.detail;this.updateBlockState({gridBlock:o})})),k(m,(e=>{const{joker:o}=e.detail;this.updateJokerState({joker:o})}))}initialize(){q.joinOrCreate(q.cachedLobbyCode).then((e=>{this.Lobby=e,this.Level=new U({Lobby:e,Game:this}),this.Score=new J({Game:this}),this.start(),this.initialized=!0})).catch((e=>{console.error("Failed to create lobby",e),this.initialized=!1}))}start(){this.state?this.continue():z.navigateTo("levelSelect")}new(){this.resetState(),this.start()}continue(){z.navigateTo("gameView"),E(h)}resetState(){this.Level.reset(),this.state=!1,A.removeItem("columnScore"),A.removeItem("colorScore")}createState(){let e,o={grid:this.Level.getGrid(),jokers:[],colorScores:{}};for(e=0;e<W.TOTAL_JOKERS;e++)o.jokers.push({selected:!1});return o}get state(){return this.#cachedState||(this.#cachedState=A.getItem("state",!1)),this.#cachedState}set state(e){this.#cachedState=e,e?A.setItem("state",e):A.removeItem("state")}updateBlockState({gridBlock:e}){let o=this.state,t=!1;o.grid.forEach(((l,r)=>{l.column===e.letter&&(o.grid[r].grid[e.row].selected=e.selected,t=!0)})),t&&(this.state=o)}updateJokerState({joker:e}){let o=this.state,t=!1;o.jokers.forEach(((o,l)=>{l===e.row&&(o.selected=e.selected,t=!0)})),t&&(this.state=o)}}class X{currentGame=!1;router;version;constructor(){e("app").innerHTML+=M.render(),this.router=new z,k(u,(o=>{const{modalId:t}=o.detail,l=e(t);l&&l.classList.contains("show")&&l.classList.remove("show"),l.dataset.selfdestruct&&l.remove()})),k(g,(o=>{const{modalId:t}=o.detail;e(t)&&!e(t).classList.contains("show")&&e(t).classList.add("show")})),this.currentGame=new W,this.parseOrientationOverlay(),this.parseGenericLoading(),e("connecting-message").innerText=a.messages.connecting,k(h,(()=>{this.render()})),L.on("version",(e=>{A.setItem("version",e)})),L.on("session",(({sessionId:e})=>{K.cachedId=e})),L.on("connect",(()=>{document.body.classList.add("connected")})),L.on("disconnect",(()=>{document.body.classList.remove("connected"),q.setPlayers([])})),L.on("game:confirm-new",(({player:e})=>{C.showNewGameModal({message:`Speler ${e.username} start een nieuw spel. Wil jij ook opnieuw beginnen?`,emit:!1})})),e("newGameButton").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),C.showNewGameModal({emit:!0})}),!1)}parseOrientationOverlay(){f({id:"orientationModal",message:a.notification.landscapeMode})}parseGenericLoading(){f({visible:!1,id:"genericLoading",message:"Aan het laden.. een moment geduld."})}parseColumnGrid(e){M.renderGrid({columns:e.grid})}parseJokerColumn(e){M.renderJokers({jokers:e.jokers})}parseScoreColumns(){e("scoreColumn1").innerHTML=W.COLORS.map((e=>new D({value:5,color:e}).render())).join(""),e("scoreColumn2").innerHTML=W.COLORS.map((e=>new D({value:3,color:e}).render())).join(""),W.COLORS.map((e=>{_.setColorScoreState({color:e})}))}parseGrid(){const{state:e}=this.currentGame;this.parseColumnGrid(e),this.parseJokerColumn(this.currentGame.state),this.parseScoreColumns(this.currentGame.state)}parseTotalScores(){if(e("totalScores"))return;const o=`\n            <div id="totalScores">\n                <div class="totals" id="bonus"><label class="rainbow">${a.label.bonus}</label><span class="label">=</span><span id="bonusTotal" class="totalValue">15</span></div>\n                <div class="totals" id="columns"><label>${a.label.columns}</label><span class="label">+</span><span id="columnsTotal" class="totalValue"></span></div>\n                <div class="totals" id="jokers"><label>${a.label.jokers}</label><span class="label">+</span><span id="jokerTotal" class="totalValue"></span></div>\n                <div class="totals" id="stars"><label>${a.label.stars}</label><span class="label">-</span><span id="starsTotal" class="totalValue"></span></div>\n                <div class="totals" id="totals">\n                    <label>${a.label.totals}</label><span class="label">&nbsp;</span><span id="totalScore" class="totalValue hide"></span>\n                </div>\n            </div>\n        `;e("scoreColumn").innerHTML+=o,e("totals").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),E(d)}),!1)}render(){this.parseGrid(),this.parseTotalScores(),E(i)}}try{window.engine=new X}catch(e){console.error("Failed to load game. Reset state!",e)}window.Block=O;
